---
title: "Untitled"
output:
  pdf_document: default
  html_document: default
date: "2024-12-08"
--- 

---
title: "Projekt Analiza Danych"
date: "`r Sys.Date()`"
output:
  rmdformats::downcute:
    self_contained: true
    default_style: "light"
    downcute_theme: "default"
---

GitGirls

W składzie: 1. Natalia Adamczyk 2. Paulina Lackowska 3. Wiktoria Gliniecka

Baza danych: Agencja nieruchomości - raport na temat agencji nieruchomości, dowiedzieć się od czego zależy CENA nieruchomości, czyli domy, mieszkania.

Plik: agencja_nieruchomosci

## Wstęp do projektu

W ramach niniejszego projektu przeprowadzono kompleksową analizę danych dotyczących rynku nieruchomości, wykorzystując zaawansowane techniki **Data Wranglingu**, **wizualizacji danych** oraz **analizy opisowej**. Celem projektu było zrozumienie kluczowych czynników wpływających na wartość i atrakcyjność nieruchomości, a także identyfikacja trendów i zależności występujących w analizowanym zbiorze danych.

Proces **Data Wranglingu** obejmował oczyszczanie, transformację i przygotowanie danych do dalszej analizy. Dzięki temu udało się uzyskać spójny i wysokiej jakości zbiór danych, który stanowił podstawę dla kolejnych etapów projektu. Następnie, wykorzystując narzędzia do **wizualizacji danych**, stworzono szereg wykresów i grafik, które pozwoliły na przejrzyste przedstawienie zależności między różnymi zmiennymi, takimi jak cena, powierzchnia, lokalizacja, liczba sypialni, dostęp do infrastruktury oraz standard wyposażenia.

**Analiza opisowa** koncentrowała się na interpretacji uzyskanych wizualizacji, co pozwoliło na wyciągnięcie istotnych wniosków dotyczących rynku nieruchomości. W szczególności, zidentyfikowano czynniki, takie jak lokalizacja w preferowanych obszarach, dostęp do drogi głównej, obecność klimatyzacji, status umeblowania oraz funkcjonalność nieruchomości, które mają znaczący wpływ na ich wartość i atrakcyjność.

Projekt ten nie tylko dostarcza cennych informacji na temat rynku nieruchomości, ale również demonstruje, jak efektywne wykorzystanie technik analizy danych może prowadzić do głębszego zrozumienia złożonych zjawisk rynkowych. Wyniki analizy mogą stanowić cenne źródło informacji dla inwestorów, deweloperów oraz nabywców, umożliwiając bardziej świadome podejmowanie decyzji inwestycyjnych i rynkowych.

```{r setup, include=FALSE}
## Global optionsuuuuuu
knitr::opts_chunk$set(cache = TRUE)
```

```{r}
install.packages("rmarkdown")
install.packages("rmdformats")
install.packages("gtsummary")
install.packages("qwraps2")
install.packages("psych")
install.packages("kableExtra")
install.packages("ggstatsplot")
library(dplyr)
library(naniar)
library(ggplot2)
library(VIM)
library(editrules)
library(validate)
library(editrules)
library(xts)
library(classInt)
library(kableExtra)
library(ggpubr)
library(ggstatsplot) 
library(psych)
library(qwraps2)
library(gtsummary)
```

```{r}
#Read data from .csv
data <- read.csv("agencja_nieruchomosci.csv")
```

Podgląd danych

```{r}
#Data preview
head(data)
```

Struktura danych

```{r}
str(data)
```

## Data Wrangling

### Eksploracja braków danych

Całkowita liczbę NA dla całej ramki danych lub dla określonej zmiennej (kolumny)

```{r}
n_miss(data)
```

Całkowita liczbę NA dla zmiennych (kolumn)

```{r}
n_miss(data$price)
n_miss(data$area)
n_miss(data$bedrooms)
n_miss(data$bathrooms)
n_miss(data$stories)
n_miss(data$mainroad)
n_miss(data$guestroom)
n_miss(data$basement)
n_miss(data$hotwaterheating)
n_miss(data$airconditioning)
n_miss(data$parking)
n_miss(data$prefarea)
n_miss(data$furnishingstatus)
```

liczba wartości innych niż NA w ramce danych lub zmiennej

```{r}
n_complete(data)
```

Proporcja wartości będących NA dla całej ramki danych

```{r}
prop_miss(data)
```

Proporcja wartości będących NA dla poszczególnych kolumn

```{r}
prop_miss(data$price)
prop_miss(data$area)
prop_miss(data$bedrooms)
prop_miss(data$bathrooms)
prop_miss(data$stories)
prop_miss(data$mainroad)
prop_miss(data$guestroom)
prop_miss(data$basement)
prop_miss(data$hotwaterheating)
prop_miss(data$airconditioning)
prop_miss(data$parking)
prop_miss(data$prefarea)
prop_miss(data$furnishingstatus)
```

tabelę podsumowującą zawierającą liczbę brakujących NA

```{r}
miss_var_summary(data) 
```

Wizualizacja brakujących wartości

```{r}
vis_miss(data)
```

### Porządkowanie struktury danych

#### Zmiana wartości (yes/no) na wartości (TRUE/FALSE)

```{r}
data$mainroad <- ifelse(data$mainroad == "yes", TRUE, 
                                ifelse(data$mainroad == "no", FALSE, NA))
                                
data$guestroom <- ifelse(data$guestroom == "yes", TRUE, 
                                ifelse(data$guestroom == "no", FALSE, NA))

data$basement <- ifelse(data$basement == "yes", TRUE, 
                                ifelse(data$basement == "no", FALSE, NA))

data$hotwaterheating <- ifelse(data$hotwaterheating == "yes", TRUE, 
                                ifelse(data$hotwaterheating == "no", FALSE, NA))

data$airconditioning <- ifelse(data$airconditioning == "yes", TRUE, 
                                ifelse(data$airconditioning == "no", FALSE, NA))
                                
data$prefarea <- ifelse(data$prefarea == "yes", TRUE, 
                                ifelse(data$prefarea == "no", FALSE, NA))

```

#### Definiowanie reguł w celu zwiększenia spójności danych

```{r}
RULE <- editset(c("price > 0","area > 0", "bedrooms >= 1","bathrooms >= 1", "stories >= 1", "mainroad %in% c(TRUE,FALSE)","guestroom %in% c(TRUE,FALSE)", "basement %in% c(TRUE,FALSE)", "hotwaterheating %in% c(TRUE,FALSE)", "airconditioning %in% c(TRUE,FALSE)", "prefarea %in% c(TRUE,FALSE)", "parking >= 0", "furnishingstatus %in% c('furnished','semi-furnished','unfurnished')"))
RULE
```

#### Podsumowanie rekordów niespełniających ustalonej wyżej reguły

```{r}
summary(violatedEdits(RULE, data))
violations_summary <- summary(violatedEdits(RULE, data))
str(violations_summary)


#plot(violated)

```

Z podsumowania danych łamiących zapisaną wyżej regułę wynika, że większość wierszy (66.6%) w danych spełnia wszystkie reguły walidacyjne (errors = 0). 28.4% wierszy narusza jedną regułę (errors = 1). 4.8% wierszy narusza dwie reguły (errors = 2). 0.2% wierszy narusza trzy reguły (errors = 3).To jaka część obserwacji nie spełani reguł możemy zobaczyć na wykresie.

Dla spójności i poprawności danych stodujemy reguły walidacyjne. Wykorzystujemy zdefiniowane wcześniej reguły. Błędne wartości w danych zastąpujemy NA, co umożliwia ich łatwą identyfikację i w puźniejszych krokach ułatwi wykosztanie ich w analizie. Wykorzystujemy do tego celu bibliotekę validate, aby wszytskie obserwacje łamiące wspomniane regułu zastępujemy wartością NA.Oznacza to, że będzie możliwe implementacja w to miejsce wartości spełniające wymogi danych.

```{r}
RULE <- validator(
  price > 0,
  area > 0,
  bedrooms >= 1,
  bathrooms >= 1,
  stories >= 1,
  mainroad %in% c('TRUE', 'FALSE'),
  guestroom %in% c('TRUE', 'FALSE'),
  basement %in% c('TRUE', 'FALSE'),
  hotwaterheating %in% c('TRUE', 'FALSE'),
  airconditioning %in% c('TRUE', 'FALSE'),
  prefarea %in% c('TRUE', 'FALSE'),
  parking >= 0,
  furnishingstatus %in% c('furnished', 'semi-furnished', 'unfurnished')
)

correct_with_rules <- function(data, rules) {
  violations <- confront(data, rules)
  for (col in names(data)) {
    if (col %in% names(rules)) {
      invalid_rows <- values(violations)[, col] == FALSE
      data[[col]][invalid_rows] <- NA
    }
  }
  return(data)
}
```

### Wartości odstające

#### Analiza wartości odstających dla zmiennej 'price'

Identyfikujemy wartości odstające w zmiennej `price` Następnie znajdujemy indeksy wierszy zawierających te wartości odstające za pomocą funkcji `which`. Używamy wykresu pudełkowegp do wizualizacji zmiennej `price`, gdzie outliery są automatycznie zaznaczane na wykresie. W kolejnych krokach modyfikujemy wartości w drugiej kolumnie dla wierszy z wartościami odstającymi w `price`, dzieląc je przez 10 w celu ich zmniejszenia. Ten proces pozwala nam spojrzeć na przeciętne wartości dla danych o sprzedaży mieszkań. Jeśli chodzi o cenę jest ona zmienną mocno subiektywną. Niekoniecznie wynika z faktycznej wartości produktu ale np. z bardzo konkretnej lokalizacji. Ponieważ w naszych danych nie mamy informacji o np. wspomnianej konkretnej lokalizacji nie możemy wziąć jej pod uwagę przy dalaszej interpretacji ceny. Dane bez wprowadzonych modyfikacji zostawiamy jako 'data_with_outliars'dla celów porównawczych.

```{r}
outliers <- boxplot.stats(data$price)$out
outliers_idx <- which(data$price %in% outliers)
data[outliers_idx,]

boxplot(data$price, 
        main = "Wartości odstające dla zmiennej 'price'",
        ylab = "Wartości price",
        col = "lightblue",
        outline = TRUE)

data[outliers_idx, 2] <- data[outliers_idx, 2] / 10

data_with_outliars <- read.csv("agencja_nieruchomosci.csv")
```

#### Analiza wartości odstających dla zmiennej 'area'

Drugą zmienną w której mogą wystapić wartości odstające jest zmienna 'area'. Dlatego przechodzimy do identyfikacji wartości odstających w zmiennej `area` do ich lepszego zobrazowania wykorzystamy wykres pudełkowy. Widzimy, że są to wartości ekstremalnie wysokie. Na razie nie będziemy modyfikować tych wartości. Z perspektywy biznesowej ważne jest aby zbadać jak duża powierzchnia wpływa na cenę. Czy w przypadku odstających pod katem wielkości są one również zdecydowanie droższe.

```{r}

outliers <- boxplot.stats(data$area)$out
outliers_idx <- which(data$area %in% outliers)
data[outliers_idx,]

boxplot(data$area, 
        main = "Wartości odstające dla zmiennej 'area'",
        ylab = "Wartości area",
        col = "lightblue",
        outline = TRUE)

```

### Eksploracja danych

#### Sortowanie danych rosnąco według zmiennej 'price'.

Ponieważ Dla naszej analizy kluczową zmienną będzie cena a pytania jake sobie postawimy będą głównie związane z tym jakie czynniki na nią wpływają. ustawienie danych roznąco pod kątem ceny ułatwi prace i podglądanie struktury danych. Łatwiej w ten sposób zauważyć jakie są

```{r}
data %>% arrange('price')
```

#### Analiza struktury danych pod kątem zmiennych

```{r}

logical_columns <- c("mainroad", "guestroom", "basement", "hotwaterheating", "airconditioning", "prefarea")

for (col in logical_columns) {
  total <- sum(!is.na(data[[col]]))
  true_percent <- round(sum(data[[col]] == TRUE, na.rm = TRUE) / total * 100, 2)
  false_percent <- round(sum(data[[col]] == FALSE, na.rm = TRUE) / total * 100, 2)
  cat(sprintf("Kolumna: %s, TRUE: %.2f%%, FALSE: %.2f%%\n", col, true_percent, false_percent))
}
```

Kolumna: mainroad, TRUE: 86.46%, FALSE: 13.54% Kolumna: guestroom, TRUE: 17.80%, FALSE: 82.20% Kolumna: basement, TRUE: 35.05%, FALSE: 64.95% Kolumna: hotwaterheating, TRUE: 4.59%, FALSE: 95.41% Kolumna: airconditioning, TRUE: 31.56%, FALSE: 68.44% Kolumna: prefarea, TRUE: 24.65%, FALSE: 75.35%

Dodatkowo aby lepiej zobarzować dane pokazane w podsumowaniu tworzymy wykresy słupkowe dla podanych zmiennych

```{r}
for (col in logical_columns) {
  true_percent <- mean(data[[col]] == TRUE, na.rm = TRUE) * 100
  false_percent <- mean(data[[col]] == FALSE, na.rm = TRUE) * 100
  
  barplot(
    c("TRUE" = true_percent, "FALSE" = false_percent),
    main = paste("Procent TRUE/FALSE dla", col),
    ylab = "Procent",
    col = c("lightblue", "lightcoral")
  )
}
```

#### Analiza struktury danych dla zmiennej 'furnishingstatus'

```{r}
furnishing_counts <- table(data$furnishingstatus)
furnishing_percentages <- round(prop.table(furnishing_counts) * 100, 2)


print(furnishing_percentages)


barplot(
  furnishing_percentages,
  main = "Procentowy rozkład furnishingstatus",
  ylab = "Procent",
  col = c("lightblue", "lightgreen", "lightcoral"),
  names.arg = names(furnishing_percentages)
)
```

#### Imputacja braków danych metodą sequential hotdeck

Zdecydowałyśmy się na metodę sequential hot-deck do imputacji brakujących danych.Metoda Sequential hot-deck wykorzystuje rzeczywiste wartości z naszego zbioru danych, co sprawia, że prawdopodobieństwo wprowadzenia sztucznych wartości jest małe. Dodatkowo załeży nam na zachowaniu naturalnego rozkładu danych. Metoda ta jest elastyczna i działa zarówno dla danych liczbowych, jak i kategorycznych, nie wymagając założeń o rozkładzie zmiennych. Dodatkowo, metoda ta jest odporna na outliery co było dla nas ważne po wcześniejszym zbadaniu ich występowania dla zmiennych price i area. na koniec prównamy brakujące dane przed i po imputacji aby upewnić się, że proces przebiegł pomyślnie.

```{r}

data_not_cleaned <- hotdeck(data)


cat("Liczba brakujących wartości po imputacji:", sum(is.na(data_not_cleaned)), "\n")


remove_imp_columns <- function(df) {
 
  if (!is.data.frame(df)) {
    stop("Podany obiekt nie jest ramką danych")
  }
  
 
  imp_cols <- grep("_imp$", colnames(df), value = TRUE)
  
 
  if (length(imp_cols) == 0) {
    message("Nie znaleziono kolumn z '_imp' w nazwie.")
    return(df)
  }
  

  df_cleaned <- df[, !colnames(df) %in% imp_cols]
  
  message("Usunięto następujące kolumny: ", paste(imp_cols, collapse = ", "))
  
  return(df_cleaned)
}


data_imputed <- remove_imp_columns(data_not_cleaned)


cat("Struktura danych po usunięciu kolumn '_imp':")
str(data_imputed)


head(data_imputed)
```

#### Normalizacja zmiennych numerycznych

Kolejnym etapem jest normalizacja zmiennych numerycznych, takich jak cena, powierzchnia, liczba sypialni, czy liczba miejsc parkingowych, co pozwala na przekształcenie danych do wspólnej skali bez utraty relatywnej informacji. Do tego celu wykorzystano metodę min-max scaling, która przekształca wartości w przedziale od 0 do 1, co ułatwia dalsze analizy statystyczne oraz modelowanie. Proces normalizacji zapewnia większą spójność danych i eliminuje wpływ różnych skal poszczególnych zmiennych na wyniki analizy.Dzięki zastosowanym technikom przetwarzania danych uzyskane wyniki pozwolą na dokładniejszą interpretację wpływu poszczególnych cech nieruchomości na ich wartość rynkową oraz na lepsze przygotowanie danych do wykorzystania w modelach predykcyjnych.

```{r}
minmax <- function(data, columns_to_normalize) {
  # Sprawdzenie, czy podane kolumny istnieją w danych
  missing_cols <- setdiff(columns_to_normalize, colnames(data))
  if (length(missing_cols) > 0) {
    stop(paste("Nie znaleziono kolumn:", paste(missing_cols, collapse = ", ")))
  }
  
  # Normalizacja wybranych kolumn
  data_imputed <- data %>%
    mutate(across(all_of(columns_to_normalize), 
                  ~ ifelse(all(is.na(.)), NA,  # Jeśli wszystkie wartości NA, zwróć NA
                           ifelse((max(., na.rm = TRUE) - min(., na.rm = TRUE)) == 0, 
                                  0,  # Jeśli brak rozstępu, przypisz 0
                                  (.-min(., na.rm = TRUE)) / (max(., na.rm = TRUE) - min(., na.rm = TRUE)))),
                  .names = "norm_{.col}"))
  
  return(data_imputed)
}

```

### Analiza opisowa

```{r table, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}

#### Tabele liczności oraz TAI

#Analizujemy zmienność cen mieszkań w zbiorze danych. Po przekształceniu zmiennej price na typ numeryczny obliczamy jej zakres oraz rozstęp. Pozwala to określić przedział, w którym mieszczą się ceny nieruchomości oraz ich maksymalne i minimalne wartości.

#Następnie grupujemy ceny mieszkań w przedziały co 1 milion złotych, co umożliwia identyfikację dominujących kategorii cenowych. 

str(data_imputed$price)
colnames(data_imputed)
as.numeric(data_imputed$price)
data_imputed$price <- as.numeric(data_imputed$price)
range(data_imputed$price, na.rm=TRUE)
max(data_imputed$price)-min(data_imputed$price, na.rm = TRUE)

etykiety<-c("1.750.000-2.750.000", "2.750.000-3.750.000", "3.750.000-4.750.000", "4.750.000-5.750.000", "5.750.000-6.750.000", "6.750.000-7.750.000", "7.750.000-8.750.000", "8.750.000-9.750.000", "9.750.000-10.750.000", "10.750.000-11.750.000")
limits <- cut(data_imputed$price,seq(1750000,12250000,by=1000000), labels=etykiety)  
table1<-table(limits)
klasy <- as.data.frame(table1)
klasy
klasy$rel_freq <- prop.table(klasy$Freq)
klasy$cum_freq <- cumsum(klasy$Freq)

names(klasy) <- c("limits", "freq", "rel_freq", "cum_freq")
View(klasy)


```
Najwięcej mieszkań znajduje się w przedziale 2.750.000-3.750.000 zł oraz 3.750.000-4.750.000 zł, co sugeruje, że większość ofert dotyczy mieszkań o średnim poziomie cenowym w badanym zbiorze.

Obserwujemy również, że liczba mieszkań maleje wraz ze wzrostem ceny – nieruchomości powyżej 10 milionów złotych stanowią niewielką część rynku. Jest to zgodne z intuicją, ponieważ luksusowe apartamenty są mniej liczne niż standardowe mieszkania.

Obliczenie częstości względnych i skumulowanych pozwala lepiej zrozumieć strukturę cen. Możemy określić, jaki procent mieszkań mieści się w określonych przedziałach, co ułatwia interpretację dostępności mieszkań w różnych segmentach cenowych.
#### Podstawowe wykresy

#### Histogram

Analizujemy rozkład cen mieszkań za pomocą histogramu oraz funkcji gęstości. Po usunięciu wartości brakujących (NA), sprawdzamy zakres cenowy, który wskazuje na minimalną i maksymalną wartość ceny mieszkań w zbiorze danych.

```{r}

data_imputed$price <- as.numeric(data_imputed$price)

filtered_prices <- na.omit(data_imputed$price)
print(filtered_prices)

price_range <- range(filtered_prices, na.rm = TRUE)
print(price_range)
```

Definiowanie przerw dla histogramu

```{r}
breaks <- seq(floor(price_range[1] / 1000000) * 1000000, ceiling(price_range[2] / 1000000) * 1000000, by = 1000000)
print(breaks)
```

Rysowanie histogramu i gęstości

```{r}
hist(filtered_prices, prob = TRUE, breaks = breaks, main = "Price", sub = "in PLN")
lines(density(filtered_prices), col = 2)
```

Histogram przedstawia liczbę mieszkań w różnych przedziałach cenowych, a dodatkowa linia gęstości (density()) pomaga zidentyfikować kształt rozkładu danych.

Na załączonym wykresie widzimy, że rozkład cen mieszkań jest prawostronnie skośny, co oznacza, że większość ofert dotyczy tańszych mieszkań, natomiast ceny luksusowych nieruchomości są bardziej rozproszone i występują rzadziej.

Najwięcej mieszkań znajduje się w przedziale około 3-5 mln zł, co jest zgodne z wcześniejszymi wynikami analizy tabeli częstości. Zauważamy również długi ogon rozkładu, wskazujący na obecność drogich nieruchomości, których ceny przekraczają 10 milionów złotych.

#### Tabela przedziałów cenowych
Tworzymy tabelę przedziałów cenowych z użyciem metody podziału na stałe klasy cenowe, co pozwala na czytelne przedstawienie częstości występowania mieszkań w określonych przedziałach.

```{r}


kbl(table1, caption = "Ceny mieszkań") %>%
  kable_material(c("striped", "hover"))
tab1<-classIntervals(data_imputed$price,n=10,style="fixed",fixedBreaks=seq(1750000,12250000,by=1000000))
price_range <- range(data_imputed$price, na.rm=TRUE)
print(price_range)
jenks.tests(tab1)

```
Obliczamy wskaźnik dokładności tabeli (TAI), który informuje nas, jak dobrze wybrane przedziały odzwierciedlają rzeczywisty rozkład danych. 


Wskaźnik TAI jest dość wysoki. 0,84 oznacza, że możemy zaakceptować zaproponowaną konstrukcję tablicy częstości, czyli możemy uznać ten podział za reprezentatywny dla zbioru danych.

Dodatkowo, wartość Goodness of Fit = 0,978 sugeruje, że klasyfikacja danych według wybranej metody pozwala na bardzo dobre odwzorowanie rzeczywistego rozkładu cen. Oznacza to, że analizowane przedziały cenowe są sensowne i dobrze opisują strukturę rynku mieszkań.
#### Analiza skumulowanego rozkładu cen mieszkań z wykorzystaniem ECDF.

```{r}
tab1<-classIntervals(data_imputed$price,n=10,style="fixed",fixedBreaks=seq(1750000,12250000,by=1000000))
pcol= c('darkblue', 'blue', 'lightblue', 'palegreen', 'lightpink', 'brown3', 'red', 'yellow', 'brown', 'black')
colcode=findColours(tab1,pcol)
plot(tab1,pal=pcol,ylab='Cumulative %')

```

Wykres ten przedstawia, jaka część obserwacji znajduje się poniżej określonych wartości cenowych, co pozwala na ocenę struktury rynku nieruchomości.

Krzywa dystrybuanty pokazuje, że większość mieszkań znajduje się w niższych przedziałach cenowych – około 80% nieruchomości kosztuje mniej niż 8 milionów złotych, a tylko niewielki odsetek przekracza 10 milionów złotych.

Dodatkowo, na wykresie zastosowane zostały kolorowe segmenty, które odpowiadają poszczególnym przedziałom cenowym, co ułatwia interpretację skumulowanego rozkładu. Można zauważyć, że największy wzrost wartości skumulowanej następuje w zakresie 3-6 milionów złotych, co potwierdza wcześniejsze analizy dotyczące dominujących przedziałów cenowych.

Wnioski te wskazują, że rynek mieszkań w analizowanym zbiorze jest skoncentrowany wokół średnich cen, a ekskluzywne nieruchomości stanowią mniejszość ofert.

#### Zastosowanie reguły Freedman/Diaconis do tworzenia histogramu

Analizujemy wpływ wyposażenia mieszkań na ich ceny, wykorzystując histogram oraz krzywe gęstości dla różnych kategorii umeblowania.

```{r histogram, echo=FALSE}
hist(data_imputed$price, breaks="FD", col="green", probability = TRUE,
     main="Ceny mieszkań")
lines(density(data_imputed$price[data_imputed$furnishingstatus=="furnished"]),col=2)
lines(density(data_imputed$price[data_imputed$furnishingstatus=="semi-furnished"]),col=3)
lines(density(data_imputed$price[data_imputed$furnishingstatus=="unfurnished"]),col=4)
legend("topright", legend=c("furnished", "semi-furnished", "unfurnished"),
       col=c(2,3), lty=1:2, horiz=FALSE, box.lty=0, cex=0.8)

```

Histogram przedstawia rozkład cen wszystkich mieszkań, z dominującą liczbą ofert w przedziale 3-6 milionów złotych. Warto zauważyć, że rozkład jest prawostronnie skośny – wyższe ceny występują rzadziej, co jest zgodne z wcześniejszymi analizami rynku.

Dodatkowo, na wykresie umieszczono trzy krzywe gęstości dla mieszkań: #Furnished (umeblowane, czerwona linia) – Rozkład tych mieszkań jest bardziej równomierny, a ceny obejmują szeroki zakres. \#*Semi-furnished (częściowo umeblowane, zielona linia) – W tej kategorii zauważamy największe skupienie ofert w okolicach 4-5 mln zł. \#*Unfurnished (nieumeblowane, niebieska linia) – Te mieszkania wydają się mieć niższe ceny, a ich rozkład jest skoncentrowany w niższych przedziałach cenowych.

Wyniki sugerują, że umeblowane mieszkania mogą osiągać wyższe ceny, natomiast brak umeblowania często wiąże się z niższymi kosztami zakupu. To potwierdza tezę, że stan wykończenia nieruchomości ma istotny wpływ na ich wartość rynkową.

#### Tworzenie wykresu pudełkowego dla cen według statusu umeblowania

Wykres pudełkowy przedstawia rozkład cen mieszkań w zależności od ich statusu umeblowania. Pozwala to na porównanie mediany, zakresu międzykwartylowego oraz wartości odstających w każdej z trzech kategorii - furnished, semi-furnished i unfurnished.

```{r boxplot, echo=FALSE}


boxplot(data_imputed$price ~ data_imputed$furnishingstatus)
```

Furnished (umeblowane) – Mediana cen mieszkań umeblowanych jest najwyższa spośród analizowanych kategorii. Rozkład jest stosunkowo szeroki, co oznacza, że ceny tych mieszkań mogą się znacząco różnić. Występuje także kilka wartości odstających w wyższych przedziałach cenowych.

Semi-furnished (częściowo umeblowane) – Ta kategoria charakteryzuje się podobną medianą do mieszkań umeblowanych, ale posiada większą liczbę wartości odstających. Wskazuje to na dużą zmienność cen w tej grupie, co może być związane z różnym standardem wykończenia.

Unfurnished (nieumeblowane) – Mediana cen jest najniższa spośród wszystkich kategorii, a rozstęp międzykwartylowy jest podobny do kategorii semi-furnished. Wartości odstające sugerują, że niektóre nieumeblowane mieszkania mogą osiągać ceny porównywalne do droższych ofert umeblowanych.

Ogólnie, analiza wykazuje, że umeblowane mieszkania mają tendencję do osiągania wyższych cen, co może wynikać z większego zainteresowania kupujących w pełni wyposażonymi nieruchomościami. Warto również zwrócić uwagę na liczne wartości odstające, co wskazuje na istnienie mieszkań w bardzo wysokich przedziałach cenowych w każdej z kategorii.

#### Tworzenie wykresu gęstości dla cen z uwzględnieniem statusu umeblowania

```{r histogram2, echo=FALSE}

density.p <- ggdensity(data_imputed, x = "price", 
                       fill = "furnishingstatus", palette = "jco")+
  stat_overlay_normal_density(color = "red", linetype = "dashed")
View(density.p)


####Tabela tekstowa z wynikami
stable.p <- ggtexttable(stable, rows = NULL, 
                        theme = ttheme("mOrange"))

text <- paste("Ceny mieszkań wg statusu umeblowania.",
               sep = " ")
text.p <- ggparagraph(text = text, face = "italic", size = 11, color = "black")

####Aranżujemy wykresy na tym samym panelu:
  
ggarrange(density.p, stable.p, text.p, 
          ncol = 1, nrow = 3,
          heights = c(1, 0.5, 0.3))

```

#### Wykres - estymacja gęstości cen mieszkań

```{r}

stable <- desc_statby(data_imputed, measure.var = "price",
                      grps = "furnishingstatus")
stable <- stable[, c("furnishingstatus", "length", "mean", "sd")]
```

Wykres przedstawia estymację gęstości cen mieszkań w zależności od ich statusu umeblowania. Analiza obejmuje trzy kategorie: furnished (umeblowane), semi-furnished (częściowo umeblowane) oraz unfurnished (nieumeblowane).

Mieszkania częściowo umeblowane (żółty) dominują w zakresie ok. 4–6 mln PLN i wykazują najwyższą gęstość w tym przedziale cenowym. #Umeblowane mieszkania (niebieski) mają szerszy rozkład i większą wariancję, co oznacza większe zróżnicowanie cenowe. #Nieumeblowane mieszkania (szary) skupiają się wokół niższych wartości, co sugeruje, że w tej kategorii znajdują się najtańsze oferty. #Czerwona linia przerywana przedstawia nałożoną krzywą normalną, co pozwala porównać empiryczny rozkład z teoretycznym.

Średnia cena mieszkań umeblowanych wynosi 5 342 367 PLN, co jest najwyższą wartością spośród wszystkich kategorii. #Częściowo umeblowane mieszkania mają średnią 4 864 801 PLN, co sugeruje, że oferują pewien kompromis między ceną a standardem wyposażenia. Nieumeblowane mieszkania mają najniższą średnią cenę (4 265 242 PLN), co potwierdza wcześniejsze obserwacje na wykresie. #Odchylenie standardowe (SD) wskazuje na większe zróżnicowanie cen wśród mieszkań umeblowanych, podczas gdy ceny mieszkań częściowo umeblowanych są bardziej skumulowane wokół średniej.

Mieszkania umeblowane są przeciętnie droższe, ale ich ceny są bardziej zróżnicowane. Z kolei nieumeblowane lokale charakteryzują się niższymi cenami, co może wynikać z niższej atrakcyjności dla kupujących.

#### Tworzenie wykresu pudełkowego z oznaczeniem średnich wartości

```{r boxplot2, echo=FALSE}

ggplot(data_imputed, aes(x=furnishingstatus, y=price)) +
    geom_boxplot(alpha=0.7) +
    stat_summary(fun="mean", geom="point", shape=20, size=5, color="red", fill="red") +
 geom_jitter() +
    facet_grid(~furnishingstatus) +
    scale_fill_brewer(palette="Set1")
```

Wykres pudełkowy cen mieszkań według statusu umeblowania #Wykres przedstawia rozkład cen mieszkań dla trzech kategorii umeblowania: umeblowane (furnished), częściowo umeblowane (semi-furnished) i nieumeblowane (unfurnished).

Pudełka pokazują rozstęp międzykwartylowy (IQR) – czyli obszar między 25. a 75. percentylem cen mieszkań. #Wąsy wskazują rozpiętość cen bez wartości odstających. #Czarne kropki reprezentują indywidualne obserwacje (każde mieszkanie jako punkt). #Czerwone punkty oznaczają średnie wartości cen dla każdej kategorii umeblowania. #Funkcja jitter rozrzuca kropki poziomo, aby uniknąć ich nakładania. #Interpretacja wyników

Mediany cen (środkowe linie pudełek) sugerują, że umeblowane mieszkania są najdroższe, a nieumeblowane mają najniższą medianę ceny. #Rozkład cen jest zróżnicowany, zwłaszcza dla mieszkań umeblowanych, które mają szerszy przedział cenowy. #Wartości odstające (punkty powyżej górnych wąsów) wskazują na istnienie luksusowych, bardzo drogich mieszkań we wszystkich trzech kategoriach. #Średnia cena (czerwony punkt) dla mieszkań umeblowanych jest wyraźnie wyższa niż dla pozostałych kategorii. #Wnioski

Mieszkania umeblowane są droższe, ale ich ceny są bardziej zróżnicowane. #Ceny mieszkań częściowo umeblowanych i nieumeblowanych są bardziej skupione wokół mediany, co sugeruje mniejsze różnice między najtańszymi i najdroższymi ofertami. #Istnieją mieszkania o ekstremalnie wysokich cenach, które mogą wpływać na średnią wartość w każdej kategorii.

#### Grupowanie wykresów według liczby pokoi

```{r facet1, echo=FALSE}

plot1 <- ggplot(data_imputed, aes(x=bedrooms, price)) + 
  geom_abline() +
  geom_jitter(width = 0.1, height = 0.1) 
plot1 + facet_wrap(~ bedrooms)

```

Wykres przedstawia rozrzut cen mieszkań w zależności od liczby sypialni, gdzie każda kategoria ma swój osobny panel. Każdy punkt oznacza pojedyncze mieszkanie, a zastosowanie funkcji jitter pozwala na lepszą czytelność poprzez lekkie przesunięcie nakładających się wartości. Na osi pionowej widoczne są ceny nieruchomości, które różnią się w zależności od liczby pokoi.

Największa liczba mieszkań występuje w przedziale od dwóch do czterech sypialni, co sugeruje, że są to najpopularniejsze układy. Ceny generalnie rosną wraz ze wzrostem liczby pokoi, choć widać duże różnice w poszczególnych kategoriach. Mieszkania jednopokojowe oraz te z sześcioma sypialniami występują najrzadziej, a ich ceny są dość rozproszone. W przypadku nieruchomości cztero- i pięciopokojowych obserwujemy największy rozrzut cen, co może sugerować istnienie zarówno standardowych mieszkań, jak i luksusowych apartamentów w tej grupie.

Niektóre wartości odstające wskazują na wyjątkowo drogie nieruchomości w każdej kategorii. Mimo że liczba sypialni ma wyraźny wpływ na cenę, inne czynniki, takie jak lokalizacja czy standard wykończenia, również mogą odgrywać istotną rolę. Warto zwrócić uwagę na mieszkania z sześcioma sypialniami, które choć nieliczne, mogą mieć niestandardowy zakres cenowy.

#### Porównanie średniej, mediany i kwantyli dla cen

```{r}


mean(data_imputed$price)
    median(data_imputed$price)
    sd(data_imputed$price) #standard deviation
    var(data_imputed$price) #variance
    coeff_var<-sd(data_imputed$price)/mean(data_imputed$price) #coefficient of variability %
    coeff_var
    IQR(data_imputed$price)# difference between quartiles =Q3-Q1 
    sx<-IQR(data_imputed$price)/2  #interquartile deviation
    coeff_varx<-sx/median(data_imputed$price) #IQR coefficient of variability %
    coeff_varx
    min(data_imputed$price)
    max(data_imputed$price)
    quantile(data_imputed$price,probs=c(0,0.1,0.25,0.5,0.75,0.95,1),na.rm=TRUE)
    
```

Średnia cena mieszkań wynosi 4 791 659, natomiast mediana, czyli wartość środkowa zbioru, jest nieco niższa i wynosi 4 340 000. Odchylenie standardowe, które mierzy rozproszenie danych wokół średniej, wynosi 1 887 452, a wariancja, będąca kwadratem odchylenia standardowego, osiąga wartość 3,56 × 10¹². Wskaźnik zmienności, określający względne zróżnicowanie cen, wynosi 39,39%, co wskazuje na umiarkowane zróżnicowanie cen mieszkań w zbiorze.

Różnica między trzecim a pierwszym kwartylem, czyli rozstęp międzykwartylowy, wynosi 2 310 000. Połowa wartości znajduje się w przedziale od 3 493 000 do 5 803 000. Średnie odchylenie międzykwartylowe wynosi 1 155 000, a wskaźnik zmienności oparty na rozstępie międzykwartylowym to 26,61%, co sugeruje mniejsze zróżnicowanie cen w środkowym zakresie danych.

Minimalna cena mieszkania wynosi 1 750 000, a maksymalna 12 250 000. Kwartyle wskazują, że 10% najtańszych mieszkań ma ceny poniżej 2 870 000, a 10% najdroższych przekracza 8 400 000. Środkowe 50% mieszkań znajduje się w przedziale od 3 493 000 do 5 803 000, co daje lepszy obraz dominujących cen na rynku.

#### Tworzenie tabeli z wykresami dla różnych liczby pokoi

```{r kable_report1, echo=FALSE}

data_imputed_list <- split(data_imputed$price, data_imputed$bedrooms)
inline_plot <- data.frame(rooms = c(1, 2, 3, 4, 5, 6), boxplot = "", histogram = "", line1 = "", line2 = "", points1 = "")
  inline_plot %>%
  kbl(booktabs = TRUE) %>%
  kable_paper(full_width = FALSE) %>%
  column_spec(2, image = spec_boxplot(data_imputed_list)) %>%
  column_spec(3, image = spec_hist(data_imputed_list)) %>%
  column_spec(4, image = spec_plot(data_imputed_list, same_lim = TRUE)) %>%
  column_spec(5, image = spec_plot(data_imputed_list, same_lim = FALSE)) %>%
  column_spec(6, image = spec_plot(data_imputed_list, type = "p"))

```

Obraz przedstawia tabelę zawierającą różne wizualizacje rozkładu cen mieszkań w zależności od liczby pokoi. W pierwszej kolumnie oznaczone są liczby pokoi od 1 do 6. W kolejnych kolumnach znajdują się wykresy pudełkowe pokazujące medianę, kwartyle i wartości odstające dla każdej grupy, histogramy przedstawiające rozkład cen w danej kategorii, a także różne warianty wykresów liniowych i punktowych.

Wykresy pudełkowe ujawniają rozrzut cen w każdej grupie i potencjalne wartości odstające. Histogramy pozwalają ocenić symetrię oraz ewentualne skośności rozkładu. Wykresy liniowe mogą sugerować trendy w rozkładzie cen w poszczególnych grupach, a wykresy punktowe obrazują indywidualne obserwacje. Tego typu zestawienie pomaga w analizie, jak zmienia się rozkład cen w zależności od liczby pokoi, umożliwiając porównanie różnych grup na jednym, czytelnym wykresie.

#### Tworzenie tabeli z wykresami według ogrzewania wody

```{r kable_report3, echo=FALSE}

mieszkania_list <- split(data_imputed$price, data_imputed$hotwaterheating)
inline_plot <- data.frame(hotwaterheating = c(TRUE, FALSE), boxplot = "", histogram = "", line1 = "", line2 = "", points1 = "")
  inline_plot %>%
  kbl(booktabs = TRUE) %>%
  kable_paper(full_width = FALSE) %>%
  column_spec(2, image = spec_boxplot(mieszkania_list)) %>%
  column_spec(3, image = spec_hist(mieszkania_list)) %>%
  column_spec(4, image = spec_plot(mieszkania_list, same_lim = TRUE)) %>%
  column_spec(5, image = spec_plot(mieszkania_list, same_lim = FALSE)) %>%
  column_spec(6, image = spec_plot(mieszkania_list, type = "p"))

```

Obraz przedstawia tabelę z wykresami ilustrującymi rozkład cen mieszkań w zależności od dostępności ogrzewania wody. Dane zostały podzielone na dwie grupy: mieszkania z ogrzewaniem wody (TRUE) oraz bez niego (FALSE). W pierwszej kolumnie znajduje się informacja o dostępności tej cechy, a kolejne kolumny zawierają różne wizualizacje rozkładu cen.

Wykresy pudełkowe pokazują medianę, kwartyle i wartości odstające dla każdej grupy, histogramy przedstawiają kształt rozkładu cen, natomiast wykresy liniowe i punktowe umożliwiają analizę trendów i rozrzutu danych. Dzięki tej tabeli można łatwo porównać, jak obecność ogrzewania wody wpływa na ceny mieszkań i czy w obu grupach występują istotne różnice w ich rozkładzie.

```{r kable_report2, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
raport <-
  list("Cena" =
       list("Min"= ~ min(data_imputed$price),
            "Max"= ~ max(data_imputed$price),
            "Kwartyl dolny"= ~ quantile(data_imputed$price,0.25),
            "Mediana"= ~ round(median(data_imputed$price),2),
            "Kwartyl górny"= ~ quantile(data_imputed$price,0.75),
            "Średnia"= ~ round(mean(data_imputed$price),2),
            "Odch. std."= ~ round(sd(data_imputed$price),2),
            "IQR"= ~ round(iqr(data_imputed$price),2),
            "Odchylenie ćwiartkowe"=~round(iqr(data_imputed$price)/2,2),
            "Odch. std. w %"=~round((sd(data_imputed$price)/mean(data_imputed$price)),2),
            "Odch. ćwiartkowe w %"=~round((iqr(data_imputed$price)/median(data_imputed$price)),2),
            "Skośność"=~round(skew(data_imputed$price),2),
            "Kurtoza"=~round(kurtosi(data_imputed$price),2)
            ))
tabela<-summary_table(data_imputed, summaries = raport, by = data_imputed$bedrooms)
tabela
```

#### Tabela - rozkład cen mieszkań w zależności od liczby pokoi.

```{r}

data_imputed %>%
  select(price, bedrooms) %>%
  tbl_summary(
    by=bedrooms,
    type = all_continuous() ~ "continuous2",
    statistic = all_continuous() ~ c(
      "{N_nonmiss}","{mean}","{sd}",
      "{median} ({p25}, {p75})",
      "{min}, {max}"),
    missing = "no",
    label = price ~ "Cena") %>%
  modify_header(label ~ "**Zmienna**") %>%
  modify_caption("**Tabela 1. Rozkład cen wg liczby pokoi**") %>%
  bold_labels() %>% 
  add_p(pvalue_fun = ~ style_pvalue(.x, digits = 2))
```

Tabela przedstawia rozkład cen mieszkań w zależności od liczby pokoi. Dla każdej grupy liczbowej podana jest liczba obserwacji, średnia cena, odchylenie standardowe, mediana wraz z pierwszym i trzecim kwartylem oraz wartości minimalne i maksymalne. Test Kruskala-Wallisa wykazał istotną statystycznie różnicę pomiędzy grupami pod względem ceny mieszkań (p \< 0.001). Widać, że średnia cena rośnie wraz ze wzrostem liczby pokoi – od około 2,7 mln dla mieszkań jednopokojowych do ponad 6,2 mln dla mieszkań pięciopokojowych. Rozstęp wartości maksymalnych i minimalnych również się zwiększa, co wskazuje na większe zróżnicowanie cen w większych mieszkaniach. #Wizualizacja danych 1. Mapowanie danych (wykresy) Na przykładzie zależności między ceną (price) a powierzchnią (area).

####Podsumowanie analizy opisowej danych

Przeprowadzona analiza opisowa danych dostarczyła szczegółowego obrazu rynku nieruchomości, uwzględniając kluczowe statystyki i ich interpretację. Wyniki analizy wskazują na istotne zależności między zmiennymi, które wpływają na ceny mieszkań oraz ich rozkład w różnych grupach.

Średnia cena nieruchomości wynosi około 4,79 mln, natomiast mediana, która jest mniej podatna na wartości odstające, kształtuje się na poziomie 4,34 mln. Rozstęp wartości wskazuje na duże zróżnicowanie cen – minimalna wartość wynosi 1,75 mln, podczas gdy maksymalna osiąga 12,25 mln. Odchylenie standardowe wynoszące 1,89 mln wskazuje na znaczne rozproszenie danych, co potwierdza również współczynnik zmienności na poziomie 39%.

Analiza kwartylowa wykazała, że 25% mieszkań kosztuje mniej niż 3,49 mln, natomiast 75% nie przekracza 5,8 mln, co sugeruje, że większość mieszkań mieści się w tym przedziale cenowym. Wskaźnik IQR potwierdza, że środkowa połowa obserwacji charakteryzuje się stosunkowo dużą zmiennością cen.

Zróżnicowanie cen w zależności od liczby pokoi ukazuje wyraźną tendencję wzrostową – średnie ceny rosną wraz z większą liczbą sypialni. Najtańsze mieszkania jedno- i dwupokojowe mają znacznie niższą medianę niż większe nieruchomości. Dodatkowo, test Kruskala-Wallisa wykazał istotne statystycznie różnice pomiędzy grupami liczby pokoi pod względem ceny.

Podział cen według statusu umeblowania wykazał pewne różnice między grupami. Mieszkania umeblowane osiągają wyższe ceny w porównaniu do nieumeblowanych i częściowo umeblowanych, co sugeruje, że gotowość do zamieszkania jest istotnym czynnikiem wpływającym na wartość nieruchomości.

Dodatkowa analiza uwzględniająca sposób ogrzewania wody pokazała, że mieszkania z tą instalacją mogą osiągać wyższe ceny, choć różnice te wymagają dalszej interpretacji. Wizualizacje danych w postaci wykresów pudełkowych, histogramów oraz wykresów punktowych pomogły w identyfikacji wartości odstających oraz ogólnych trendów.

Podsumowując, analiza opisowa dostarczyła cennych informacji na temat struktury cen nieruchomości oraz ich zależności od kluczowych cech. Wyniki te mogą być przydatne dla inwestorów i analityków rynku nieruchomości w celu lepszego zrozumienia dynamiki cenowej i podejmowania bardziej świadomych decyzji.

### Wizualizacja danych

#### Wykres rozrzutu z ceną na osi Y i powierzchnią na osi X

```{r}

library(ggplot2)

ggplot(data_imputed, aes(x = area, y = price, color = prefarea)) +
  geom_point(size = 3, alpha = 0.7) +
  scale_color_manual(values = c("TRUE" = "blue", "FALSE" = "red")) +
  labs(title = "Cena vs. Powierzchnia z podziałem na preferowaną lokalizację",
       x = "Powierzchnia (m2)",
       y = "Cena (PLN)") +
  theme_minimal()
```

Wykres przedstawia zależność między ceną nieruchomości a ich powierzchnią, z uwzględnieniem podziału na preferowane obszary. Na osi pionowej znajduje się cena w PLN, a na osi poziomej powierzchnia w metrach kwadratowych. Wartości ceny wahają się od 2,500,000 PLN do 12,500,000 PLN, podczas gdy powierzchnia mieści się w zakresie od 0 do 16,000 m². Wykres wskazuje na ogólną tendencję wzrostu ceny wraz ze wzrostem powierzchni, co jest zgodne z oczekiwaniami. Punkty danych są podzielone na dwie kategorie: prefarea = TRUE i prefarea = FALSE. Można zauważyć, że nieruchomości zlokalizowane w preferowanych obszarach (prefarea = TRUE) mają tendencję do osiągania wyższych cen przy podobnej powierzchni w porównaniu do nieruchomości z obszarów niepreferowanych.

Wnioski: Lokalizacja w preferowanym obszarze ma istotny wpływ na cenę nieruchomości, co sugeruje, że czynniki lokalizacyjne są kluczowe w wycenie nieruchomości.

#### Wizualizacja ilości

<!-- -->

a)  Histogram rozkładu liczby sypialni (bedrooms).

```{r}
####Histogram liczby sypialni
ggplot(data_imputed, aes(x = bedrooms)) +
  geom_bar(fill = "steelblue", color = "black", alpha = 0.8) +
  labs(title = "Rozkład liczby sypialni",
       x = "Liczba sypialni",
       y = "Liczba nieruchomości") +
  theme_minimal()
```

Wykres przedstawia rozkład liczby sypialni w analizowanych nieruchomościach. Na osi pionowej znajduje się liczba nieruchomości, a na osi poziomej liczba sypialni. Większość nieruchomości posiada od 2 do 4 sypialni, co wskazuje na dominację nieruchomości o średniej wielkości. Nieruchomości z 1 sypialnią lub więcej niż 4 sypialnie są znacznie mniej liczne.

Wnioski: Rozkład ten sugeruje, że rynek nieruchomości jest zdominowany przez mieszkania i domy o średniej wielkości, co może odzwierciedlać preferencje nabywców.

b)  Liczba nieruchomości w zależności od dostępu do drogi głównej (mainroad):

```{r}
####Histogram liczby nieruchomości z dostępem do drogi głównej
ggplot(data_imputed, aes(x = mainroad)) +
  geom_bar(fill = "orange", color = "black", alpha = 0.8) +
  labs(title = "Liczba nieruchomości z dostępem do drogi głównej",
       x = "Dostęp do drogi głównej",
       y = "Liczba nieruchomości") +
  theme_minimal()
```

Wykres przedstawia liczbę nieruchomości z dostępem do drogi głównej, podzielonych na kategorie TRUE (dostęp) i FALSE (brak dostępu). Większość nieruchomości posiada dostęp do drogi głównej, co może wpływać na ich atrakcyjność i cenę. Nieruchomości bez dostępu do drogi głównej stanowią mniejszość.

Wnioski: Dostęp do drogi głównej jest istotnym czynnikiem wpływającym na wartość nieruchomości, co może być związane z wygodą dojazdu i ogólną dostępnością.

c)  Liczba nieruchomości z klimatyzacją (airconditioning):

```{r}
####Histogram liczby nieruchomości z klimatyzacją
ggplot(data_imputed, aes(x = airconditioning)) +
  geom_bar(fill = "cyan", color = "black ", alpha = 0.8) +
  labs(title = "Liczba nieruchomości z klimatyzacją",
       x = "Klimatyzacja",
       y = "Liczba nieruchomości") +
  theme_minimal()
```

Wykres przedstawia liczbę nieruchomości wyposażonych w klimatyzację, podzielonych na kategorie TRUE (klimatyzacja) i FALSE (brak klimatyzacji). Większość nieruchomości nie posiada klimatyzacji, co może odzwierciedlać specyfikę lokalnego rynku nieruchomości. Nieruchomości z klimatyzacją stanowią mniejszość, co może wpływać na ich wyższą cenę.

Wnioski: Klimatyzacja jest rzadkością w analizowanym zbiorze nieruchomości, co może sugerować, że jest to czynnik różnicujący i wpływający na wartość nieruchomości.

#### Wizualizacja rozkładów

<!-- -->

a)  Wykres rozkładu powierzchni (area) z podziałem na obecność klimatyzacji (airconditioning).

```{r}
####Wykres gęstości powierzchni z podziałem na klimatyzację
ggplot(data_imputed, aes(x = area, fill = airconditioning)) +
  geom_density(alpha = 0.6) +
  scale_fill_manual(values = c("TRUE" = "green", "FALSE" = "orange")) +
  labs(title = "Rozkład powierzchni w zależności od klimatyzacji",
       x = "Powierzchnia (m2)",
       y = "Gęstość",
       fill = "Klimatyzacja") +
  theme_minimal()
```

Wykres przedstawia rozkład powierzchni nieruchomości w zależności od obecności klimatyzacji. Na osi pionowej znajduje się gęstość, a na osi poziomej powierzchnia w metrach kwadratowych. Nieruchomości z klimatyzacją mają tendencję do większej powierzchni w porównaniu do nieruchomości bez klimatyzacji. Rozkład powierzchni dla nieruchomości z klimatyzacją jest bardziej rozproszony, co może wskazywać na większą różnorodność w tej kategorii.

Wnioski: Klimatyzacja jest częściej spotykana w większych nieruchomościach, co może sugerować, że jest to cecha charakterystyczna dla nieruchomości o wyższym standardzie.

b)  Rozkład cen (price) z podziałem na status umeblowania (furnishingstatus):

```{r}
####Rozkład cen z podziałem na umeblowanie
ggplot(data_imputed, aes(x = price, fill = furnishingstatus)) +
  geom_density(alpha = 0.6) +
  scale_fill_manual(values = c("furnished" = "purple", "semi-furnished" = "pink", "unfurnished" = "grey")) +
  labs(title = "Rozkład cen w zależności od statusu umeblowania",
       x = "Cena (PLN)",
       y = "Gęstość",
       fill = "Status umeblowania") +
  theme_minimal()
```

Wykres przedstawia rozkład cen nieruchomości w zależności od ich statusu umeblowania. Na osi pionowej znajduje się gęstość, a na osi poziomej cena w PLN. Status umeblowania jest podzielony na trzy kategorie: furnished (umeblowane), semi-furnished (częściowo umeblowane) i unfurnished (nieumeblowane). Nieruchomości umeblowane (furnished) mają tendencję do osiągania wyższych cen w porównaniu do nieruchomości częściowo umeblowanych (semi-furnished) i nieumeblowanych (unfurnished). Rozkład cen dla nieruchomości nieumeblowanych jest bardziej skoncentrowany w niższych przedziałach cenowych.

Wnioski: Status umeblowania ma istotny wpływ na cenę nieruchomości, co sugeruje, że nabywcy są skłonni płacić więcej za nieruchomości gotowe do zamieszkania.

c)  Rozkład liczby parkingów (parking):

```{r}
####Rozkład liczby parkingów
ggplot(data_imputed, aes(x = parking)) +
  geom_histogram(binwidth = 1, fill = "lightblue", color = "black", alpha = 0.8) +
  labs(title = "Rozkład liczby parkingów",
       x = "Liczba parkingów",
       y = "Liczba nieruchomości") +
  theme_minimal()
```

Wykres przedstawia rozkład liczby parkingów dostępnych w analizowanych nieruchomościach. Na osi poziomej znajduje się liczba parkingów, a na osi pionowej liczba nieruchomości. Większość nieruchomości posiada 1 lub 2 miejsca parkingowe, co wskazuje na standardową dostępność parkingów. Nieruchomości z 3 miejscami parkingowymi są rzadkością.

Wnioski: Liczba miejsc parkingowych jest istotnym czynnikiem wpływającym na atrakcyjność nieruchomości, szczególnie w obszarach o ograniczonej dostępności parkingów.

#### Wizualizacja proporcji

<!-- -->

a)  Wykres kołowy dla statusu umeblowania (furnishingstatus).

```{r}
####Proporcje statusu umeblowania
library(dplyr)

data_imputed %>%
  count(furnishingstatus) %>%
  ggplot(aes(x = "", y = n, fill = furnishingstatus)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y") +
  scale_fill_manual(values = c("furnished" = "purple", "semi-furnished" = "pink", "unfurnished" = "grey")) +
  labs(title = "Proporcja statusu umeblowania",
       fill = "Status umeblowania") +
  theme_void()
```

Wykres przedstawia proporcje nieruchomości według statusu umeblowania: furnished, semi-furnished i unfurnished. Największy odsetek nieruchomości to te nieumeblowane (unfurnished), co może odzwierciedlać preferencje nabywców do personalizacji przestrzeni. Nieruchomości umeblowane (furnished) stanowią mniejszość, ale są bardziej pożądane ze względu na wyższą cenę.

Wnioski: Rynek nieruchomości jest zdominowany przez nieruchomości nieumeblowane, co może wpływać na strategie marketingowe i wycenę nieruchomości.

b)  Proporcje dostępu do piwnicy (basement):

```{r}
data_imputed %>%
  count(basement) %>%
  ggplot(aes(x = "", y = n, fill = basement)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y") +
  scale_fill_manual(values = c("TRUE" = "blue", "FALSE" = "gray")) +
  labs(title = "Proporcja nieruchomości z piwnicą",
       fill = "Piwnica") +
  theme_void()
```

Wykres przedstawia proporcje nieruchomości z piwnicą (TRUE) i bez piwnicy (FALSE). Większość nieruchomości posiada piwnicę, co może zwiększać ich funkcjonalność i atrakcyjność. Nieruchomości bez piwnicy stanowią mniejszość.

Wnioski: Obecność piwnicy jest istotnym czynnikiem wpływającym na wartość nieruchomości, szczególnie w kontekście dodatkowej przestrzeni magazynowej.

c)  Proporcja nieruchomości z ogrzewaniem wody (hotwaterheating):

```{r}
####Wykres proporcji ogrzewania wody
data_imputed %>%
  count(hotwaterheating) %>%
  ggplot(aes(x = "", y = n, fill = hotwaterheating)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y") +
  scale_fill_manual(values = c("TRUE" = "green", "FALSE" = "red")) +
  labs(title = "Proporcja nieruchomości z ogrzewaniem wody",
       fill = "Ogrzewanie wody") +
  theme_void()
```

Wykres przedstawia proporcje nieruchomości z ogrzewaniem wody (TRUE) i bez ogrzewania wody (FALSE). Większość nieruchomości jest wyposażona w system ogrzewania wody, co jest standardem w nowoczesnych nieruchomościach. Nieruchomości bez ogrzewania wody stanowią mniejszość.

Wnioski: Ogrzewanie wody jest powszechnym i oczekiwanym udogodnieniem, które wpływa na komfort użytkowania nieruchomości.

#### Podsumowanie analizy wizualizacji danych

Przeprowadzona analiza wizualizacji danych wykonanych w R-Studio dostarcza kompleksowego obrazu rynku nieruchomości, uwzględniającego różnorodne czynniki wpływające na ich wartość i atrakcyjność. Wnioski płynące z analizy wskazują, że kluczowe determinanty cen nieruchomości obejmują lokalizację, dostęp do infrastruktury, standard wyposażenia oraz funkcjonalność.

Lokalizacja w preferowanych obszarach znacząco wpływa na wyższą wartość nieruchomości, co podkreśla wagę czynników geograficznych i społecznych. Dostęp do drogi głównej oraz liczba miejsc parkingowych są istotnymi elementami zwiększającymi atrakcyjność nieruchomości, szczególnie w kontekście wygody i dostępności.

Standard wyposażenia, taki jak klimatyzacja czy ogrzewanie wody, również odgrywa ważną rolę w kształtowaniu cen. Nieruchomości wyposażone w te udogodnienia są postrzegane jako bardziej wartościowe, co odzwierciedla preferencje nabywców dotyczące komfortu użytkowania. Status umeblowania dodatkowo różnicuje rynek, z nieruchomościami umeblowanymi osiągającymi wyższe ceny, co sugeruje, że gotowość do zamieszkania jest istotnym atutem.

Funkcjonalność nieruchomości, w tym obecność piwnicy, wpływa na ich praktyczność i atrakcyjność, szczególnie w kontekście dodatkowej przestrzeni użytkowej. Rozkład liczby sypialni wskazuje na dominację nieruchomości o średniej wielkości, co może odzwierciedlać preferencje nabywców dotyczące przestrzeni mieszkalnej.

Podsumowując, analiza wizualizacji danych pozwala na zidentyfikowanie kluczowych czynników kształtujących rynek nieruchomości. Wnioski te mogą stanowić cenne źródło informacji dla inwestorów, deweloperów oraz nabywców, umożliwiając bardziej świadome podejmowanie decyzji inwestycyjnych i rynkowych.

### Wnioskowanie statystyczne

Celem następnej części analizy jest zbadanie czynników wpływających na cenę nieruchomości, w szczególności statusu umeblowania, powierzchni oraz innych istotnych zmiennych. W ramach badania dokonano porównania cen w zależności od statusu umeblowania, przeanalizowano zależność między powierzchnią a ceną oraz zbadano korelacje pomiędzy różnymi cechami nieruchomości. Analiza ta ma na celu dostarczenie praktycznych wniosków dla inwestorów, sprzedających oraz kupujących nieruchomości, pomagając im w podejmowaniu lepiej uzasadnionych decyzji rynkowych.

W badaniu stosujemy różne metody statystyczne, w tym test ANOVA Welch’a do analizy różnic między grupami oraz współczynnik korelacji Pearsona do oceny zależności między zmiennymi. Dodatkowo przeprowadzamy testy post-hoc w celu dokładniejszego zbadania różnic pomiędzy kategoriami umeblowania. W dalszej części raportu przedstawiono wyniki i interpretacje tych analiz.

Opis statystyczny zmiennych numerycznych

```{r}
summary(data[, sapply(df, is.numeric)]) 
```

##Analiza różnic między grupami (price vs furnishingstatus)

Warto dodać, że analiza ta pozwala sprawdzić, czy status umeblowania wpływa na cenę nieruchomości, co może pomóc w określeniu preferencji rynkowych.

```{r}
ggbetweenstats( 

  data = data_imputed, 

  x = furnishingstatus, 

  y = price, 

  title = "Porównanie cen nieruchomości względem statusu umeblowania" 

) 
```
W celu określenia istotności różnic zastosujemy test ANOVA Welch’a, który wykazał statystycznie istotne różnice między grupami: F(2, 311.55) = 20.76, p = 3.44e-09 (p < 0.05), co wskazuje, że status umeblowania ma znaczący wpływ na cenę nieruchomości.Wielkość efektu (ω²) wynosi 0.11, co sugeruje umiarkowany wpływ umeblowania na cenę.Test post-hoc Games-Howell wykazał istotne różnice pomiędzy wszystkimi grupami:
Umeblowane vs. Częściowo umeblowane: p = 0.03
Umeblowane vs. Nieumeblowane: p = 4.73e-08
Częściowo umeblowane vs. Nieumeblowane: p = 1.1e-06
Wszystkie wartości p są poniżej progu istotności 0.05, co potwierdza, że różnice w cenach między kategoriami nie są przypadkowe.

Analiza wykazała, że status umeblowania ma istotny wpływ na cenę nieruchomości. Wyniki sugerują, że umeblowane nieruchomości są średnio o około 32% droższe od nieumeblowanych. Inwestowanie w umeblowanie może być strategią zwiększającą wartość nieruchomości na rynku. W dalszych badaniach warto uwzględnić inne zmienne, takie jak lokalizacja, wiek budynku czy standard wykończenia, aby uzyskać pełniejszy obraz czynników wpływających na cenę nieruchomości.


##Analiza zależności między zmiennymi (price vs area)

```{r}
ggscatterstats( 

  data = data_imputed, 

  x = area, 

  y = price, 

  title = "Korelacja między powierzchnią a ceną nieruchomości" 
)
```
Analiza przedstawia korelację między powierzchnią (area) a ceną (price) nieruchomości. Współczynnik korelacji Pearsona wynosi 𝑟^Pearson=0.22r^Pearson =0.22 z przedziałem ufności 95% [0.14, 0.30]. Oznacza to istnienie słabej, ale istotnej statystycznie dodatniej korelacji między powierzchnią a ceną nieruchomości. Test istotności korelacji wykazał t(543) = 5.36, p = 1.22e-07, co oznacza, że prawdopodobieństwo uzyskania takiego wyniku przy braku rzeczywistej zależności jest bardzo małe (p < 0.05). Dodatkowo analiza Bayesowska wskazuje na logarytm Bayes Factor log₁₀(BF₁₀) = -11.22, co sugeruje silne wsparcie dla istnienia tej korelacji.

Pomimo istotności statystycznej, siła zależności między powierzchnią a ceną nieruchomości jest stosunkowo niewielka (𝑟=0.22 r=0.22), co oznacza, że inne czynniki (np. lokalizacja, standard wykończenia) mogą mieć większy wpływ na cenę. Widzimy jednak, że wraz ze wzrostem powierzchni cena nieruchomości średnio wzrasta, choć rozproszenie danych wskazuje na dużą zmienność cen w zależności od innych zmiennych. Może to sugerować, że kupujący są skłonni płacić więcej za większe nieruchomości, ale nie jest to jedyny czynnik determinujący cenę.

##Macierz korelacji dla zmiennych numerycznych

```{r}
ggcorrmat( 

  data = data_imputed %>% select(price, area, bedrooms, bathrooms, stories, parking), 

  title = "Macierz korelacji dla wybranych zmiennych" 

) 
```
Macierz korelacji przedstawia zależności między ceną nieruchomości (price) a wybranymi zmiennymi: powierzchnią (area), liczbą sypialni (bedrooms), liczbą łazienek (bathrooms), liczbą pięter (stories) oraz liczbą miejsc parkingowych (parking). Współczynniki korelacji Pearsona wskazują siłę oraz kierunek zależności między zmiennymi. Kolory w macierzy odzwierciedlają siłę korelacji – im ciemniejszy zielony, tym wyższa wartość. Wartości oznaczone "X" są statystycznie nieistotne po korekcie Holm’a, co oznacza, że nie można wykluczyć, że są wynikiem przypadku.

Najsilniejsza korelacja z ceną występuje dla liczby łazienek (r = 0.43) oraz liczby miejsc parkingowych (r = 0.38), co sugeruje, że te czynniki mogą mieć istotny wpływ na wartość nieruchomości.

Powierzchnia (area) ma relatywnie słabą korelację z ceną (r = 0.22), co potwierdza wcześniejsze analizy – inne czynniki mogą mieć większe znaczenie.

Liczba pięter (stories) i liczba sypialni (bedrooms) nie wykazują istotnej korelacji z ceną po korekcie istotności statystycznej (oznaczone "X"), co oznacza, że ich wpływ na cenę może być znikomy.
Silna dodatnia korelacja między zmiennymi niezależnymi (np. bathrooms i stories – r = 0.41) sugeruje, że większe domy często mają więcej pięter i łazienek, co jest logiczne w kontekście projektowania budynków.
Wartość r = 0.85 dla liczby miejsc parkingowych (parking) i liczby pięter (stories) wskazuje, że te zmienne są mocno powiązane – większe domy mają więcej pięter i więcej miejsc parkingowych.
Podsumowując, analiza sugeruje, że na cenę nieruchomości największy wpływ mają liczba łazienek oraz dostępność miejsc parkingowych, natomiast liczba pięter i sypialni nie wykazuje istotnej zależności z ceną po uwzględnieniu korekty wielokrotnych testów.

##Wizualizacja proporcji zmiennej kategorycznej (furnishingstatus)

Celem tej sekcji jest identyfikacja zmiennych silnie skorelowanych, co może pomóc w modelowaniu predykcyjnym cen nieruchomości. 

```{r}
ggpiestats( 

  data = data_imputed, 

  x = furnishingstatus, 

  title = "Proporcje statusu umeblowania nieruchomości" 

) 
```
Wykres kołowy przedstawia proporcje statusu umeblowania nieruchomości w analizowanej próbie (n = 545). Podział wygląda następująco:

42% nieruchomości jest częściowo umeblowanych (semi-furnished)
33% nieruchomości jest nieumeblowanych (unfurnished)
26% nieruchomości jest w pełni umeblowanych (furnished)

Największy odsetek nieruchomości stanowią te częściowo umeblowane (42%), co sugeruje, że jest to najczęściej wybierana opcja na rynku. Nieruchomości w pełni umeblowane stanowią jedynie 26%, co może oznaczać, że kupujący częściej decydują się na samodzielne umeblowanie lub wynajem w stanie częściowym. Nieumeblowane nieruchomości (33%) również stanowią dużą część rynku, co może wynikać z preferencji nabywców do aranżacji wnętrza według własnych potrzeb lub ograniczeń budżetowych.

### Podsumowanie i wnioski końcowe


