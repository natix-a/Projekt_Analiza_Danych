---
title: "Untitled"
output: html_document
date: "2024-12-08"
---

---
title: "Projekt Analiza Danych"
date: "`r Sys.Date()`"
output:
  rmdformats::downcute:
    self_contained: true
    default_style: "light"
    downcute_theme: "default"
---

\# Projekt_Analiza_Danych

GitGirls

W składzie: 1. Natalia Adamczyk 2. Paulina Lackowska 3. Wiktoria Gliniecka

Baza danych: Agencja nieruchomości - raport na temat agencji nieruchomości, dowiedzieć się od czego zależy CENA nieruchomości, czyli domy, mieszkania.

Plik: agencja_nieruchomosci

Wstęp

### Wstęp do projektu

W ramach niniejszego projektu przeprowadzono kompleksową analizę danych dotyczących rynku nieruchomości, wykorzystując zaawansowane techniki **Data Wranglingu**, **wizualizacji danych** oraz **analizy opisowej**. Celem projektu było zrozumienie kluczowych czynników wpływających na wartość i atrakcyjność nieruchomości, a także identyfikacja trendów i zależności występujących w analizowanym zbiorze danych.

Proces **Data Wranglingu** obejmował oczyszczanie, transformację i przygotowanie danych do dalszej analizy. Dzięki temu udało się uzyskać spójny i wysokiej jakości zbiór danych, który stanowił podstawę dla kolejnych etapów projektu. Następnie, wykorzystując narzędzia do **wizualizacji danych**, stworzono szereg wykresów i grafik, które pozwoliły na przejrzyste przedstawienie zależności między różnymi zmiennymi, takimi jak cena, powierzchnia, lokalizacja, liczba sypialni, dostęp do infrastruktury oraz standard wyposażenia.

**Analiza opisowa** koncentrowała się na interpretacji uzyskanych wizualizacji, co pozwoliło na wyciągnięcie istotnych wniosków dotyczących rynku nieruchomości. W szczególności, zidentyfikowano czynniki, takie jak lokalizacja w preferowanych obszarach, dostęp do drogi głównej, obecność klimatyzacji, status umeblowania oraz funkcjonalność nieruchomości, które mają znaczący wpływ na ich wartość i atrakcyjność.

Projekt ten nie tylko dostarcza cennych informacji na temat rynku nieruchomości, ale również demonstruje, jak efektywne wykorzystanie technik analizy danych może prowadzić do głębszego zrozumienia złożonych zjawisk rynkowych. Wyniki analizy mogą stanowić cenne źródło informacji dla inwestorów, deweloperów oraz nabywców, umożliwiając bardziej świadome podejmowanie decyzji inwestycyjnych i rynkowych.

```{r setup, include=FALSE}
## Global optionsuuuuuu
knitr::opts_chunk$set(cache = TRUE)
```

```{r}
install.packages("qwraps2")
install.packages("psych")
install.packages("kableExtra")
install.packages("ggstatsplot")
library(dplyr)
library(naniar)
library(ggplot2)
library(VIM)
library(editrules)
library(validate)
library(editrules)
library(xts)
library(classInt)
library(kableExtra)
library(ggpubr)
library(ggstatsplot) 
library(psych)
library(qwraps2)
```

```{r}
#Read data from .csv
data <- read.csv("agencja_nieruchomosci.csv")
```

Podgląd danych

```{r}
#Data preview
head(data)
```

Struktura danych

```{r}
str(data)
```

# Data Wrangling

## Eksploracja braków danych

Całkowita liczbę NA dla całej ramki danych lub dla określonej zmiennej (kolumny)

```{r}
n_miss(data)
```

Całkowita liczbę NA dla zmiennych (kolumn)

```{r}
n_miss(data$price)
n_miss(data$area)
n_miss(data$bedrooms)
n_miss(data$bathrooms)
n_miss(data$stories)
n_miss(data$mainroad)
n_miss(data$guestroom)
n_miss(data$basement)
n_miss(data$hotwaterheating)
n_miss(data$airconditioning)
n_miss(data$parking)
n_miss(data$prefarea)
n_miss(data$furnishingstatus)
```

liczba wartości innych niż NA w ramce danych lub zmiennej

```{r}
n_complete(data)
```

Proporcja wartości będących NA dla całej ramki danych

```{r}
prop_miss(data)
```

Proporcja wartości będących NA dla poszczególnych kolumn

```{r}
prop_miss(data$price)
prop_miss(data$area)
prop_miss(data$bedrooms)
prop_miss(data$bathrooms)
prop_miss(data$stories)
prop_miss(data$mainroad)
prop_miss(data$guestroom)
prop_miss(data$basement)
prop_miss(data$hotwaterheating)
prop_miss(data$airconditioning)
prop_miss(data$parking)
prop_miss(data$prefarea)
prop_miss(data$furnishingstatus)
```

tabelę podsumowującą zawierającą liczbę brakujących NA

```{r}
miss_var_summary(data) 
```

Wizualizacja brakujących wartości

```{r}
vis_miss(data)
```


## Porządkowanie struktury danych 

### Zmiana wartości (yes/no) na wartości (TRUE/FALSE) 

```{r}
data$mainroad <- ifelse(data$mainroad == "yes", TRUE, 
                                ifelse(data$mainroad == "no", FALSE, NA))
                                
data$guestroom <- ifelse(data$guestroom == "yes", TRUE, 
                                ifelse(data$guestroom == "no", FALSE, NA))

data$basement <- ifelse(data$basement == "yes", TRUE, 
                                ifelse(data$basement == "no", FALSE, NA))

data$hotwaterheating <- ifelse(data$hotwaterheating == "yes", TRUE, 
                                ifelse(data$hotwaterheating == "no", FALSE, NA))

data$airconditioning <- ifelse(data$airconditioning == "yes", TRUE, 
                                ifelse(data$airconditioning == "no", FALSE, NA))
                                
data$prefarea <- ifelse(data$prefarea == "yes", TRUE, 
                                ifelse(data$prefarea == "no", FALSE, NA))

```

## Definiowanie reguł w celu zwiększenia spójności danych

```{r}
RULE <- editset(c("price > 0","area > 0", "bedrooms >= 1","bathrooms >= 1", "stories >= 1", "mainroad %in% c(TRUE,FALSE)","guestroom %in% c(TRUE,FALSE)", "basement %in% c(TRUE,FALSE)", "hotwaterheating %in% c(TRUE,FALSE)", "airconditioning %in% c(TRUE,FALSE)", "prefarea %in% c(TRUE,FALSE)", "parking >= 0", "furnishingstatus %in% c('furnished','semi-furnished','unfurnished')"))
RULE
```

### Podsumowanie rekordów niespełniających ustalonej wyżej reguły

```{r}
summary(violatedEdits(RULE, data))
violations_summary <- summary(violatedEdits(RULE, data))
str(violations_summary)


plot(violated)

```

Z podsumowania danych łamiących zapisaną wyżej regułę wynika, że większość wierszy (66.6%) w danych spełnia wszystkie reguły walidacyjne (errors = 0). 28.4% wierszy narusza jedną regułę (errors = 1). 4.8% wierszy narusza dwie reguły (errors = 2). 0.2% wierszy narusza trzy reguły (errors = 3).To jaka część obserwacji nie spełani reguł możemy zobaczyć na wykresie.

Dla spójności i poprawności danych stodujemy reguły walidacyjne. Wykorzystujemy zdefiniowane wcześniej reguły. Błędne wartości w danych zastąpujemy NA, co umożliwia ich łatwą identyfikację i w puźniejszych krokach ułatwi wykosztanie ich w analizie. Wykorzystujemy do tego celu bibliotekę validate, aby wszytskie obserwacje łamiące wspomniane regułu zastępujemy wartością NA.Oznacza to, że będzie możliwe implementacja w to miejsce wartości spełniające wymogi danych.

```{r}
RULE <- validator(
  price > 0,
  area > 0,
  bedrooms >= 1,
  bathrooms >= 1,
  stories >= 1,
  mainroad %in% c('TRUE', 'FALSE'),
  guestroom %in% c('TRUE', 'FALSE'),
  basement %in% c('TRUE', 'FALSE'),
  hotwaterheating %in% c('TRUE', 'FALSE'),
  airconditioning %in% c('TRUE', 'FALSE'),
  prefarea %in% c('TRUE', 'FALSE'),
  parking >= 0,
  furnishingstatus %in% c('furnished', 'semi-furnished', 'unfurnished')
)

correct_with_rules <- function(data, rules) {
  violations <- confront(data, rules)
  for (col in names(data)) {
    if (col %in% names(rules)) {
      invalid_rows <- values(violations)[, col] == FALSE
      data[[col]][invalid_rows] <- NA
    }
  }
  return(data)
}
```

## Wartości odstające 

### Analiza wartości odstających dla zmiennej 'price'

Identyfikujemy wartości odstające w zmiennej `price` Następnie znajdujemy indeksy wierszy zawierających te wartości odstające za pomocą funkcji `which`. Używamy wykresu pudełkowegp do wizualizacji zmiennej `price`, gdzie outliery są automatycznie zaznaczane na wykresie. W kolejnych krokach modyfikujemy wartości w drugiej kolumnie dla wierszy z wartościami odstającymi w `price`, dzieląc je przez 10 w celu ich zmniejszenia. Ten proces pozwala nam spojrzeć na przeciętne wartości dla danych o sprzedaży mieszkań. Jeśli chodzi o cenę jest ona zmienną mocno subiektywną. Niekoniecznie wynika z faktycznej wartości produktu ale np. z bardzo konkretnej lokalizacji. Ponieważ w naszych danych nie mamy informacji o np. wspomnianej konkretnej lokalizacji nie możemy wziąć jej pod uwagę przy dalaszej interpretacji ceny. Dane bez wprowadzonych modyfikacji zostawiamy jako 'data_with_outliars'dla celów porównawczych.

```{r}
outliers <- boxplot.stats(data$price)$out
outliers_idx <- which(data$price %in% outliers)
data[outliers_idx,]

boxplot(data$price, 
        main = "Wartości odstające dla zmiennej 'price'",
        ylab = "Wartości price",
        col = "lightblue",
        outline = TRUE)

data[outliers_idx, 2] <- data[outliers_idx, 2] / 10

data_with_outliars <- read.csv("agencja_nieruchomosci.csv")
```

### Analiza wartości odstających dla zmiennej 'area'

Drugą zmienną w której mogą wystapić wartości odstające jest zmienna 'area'. Dlatego przechodzimy do identyfikacji wartości odstających w zmiennej `area` do ich lepszego zobrazowania wykorzystamy wykres pudełkowy. Widzimy, że są to wartości ekstremalnie wysokie. Na razie nie będziemy modyfikować tych wartości. Z perspektywy biznesowej ważne jest aby zbadać jak duża powierzchnia wpływa na cenę. Czy w przypadku odstających pod katem wielkości są one również zdecydowanie droższe.

```{r}

outliers <- boxplot.stats(data$area)$out
outliers_idx <- which(data$area %in% outliers)
data[outliers_idx,]

boxplot(data$area, 
        main = "Wartości odstające dla zmiennej 'area'",
        ylab = "Wartości area",
        col = "lightblue",
        outline = TRUE)

```

# Eksploracja danych

## Sortowanie danych rosnąco według zmiennej 'price'.

Ponieważ Dla naszej analizy kluczową zmienną będzie cena a pytania jake sobie postawimy będą głównie związane z tym jakie czynniki na nią wpływają. ustawienie danych roznąco pod kątem ceny ułatwi prace i podglądanie struktury danych. Łatwiej w ten sposób zauważyć jakie są

```{r}
data %>% arrange('price')
```

## Analiza struktury danych pod kątem zmiennych

```{r}

logical_columns <- c("mainroad", "guestroom", "basement", "hotwaterheating", "airconditioning", "prefarea")

for (col in logical_columns) {
  total <- sum(!is.na(data[[col]]))
  true_percent <- round(sum(data[[col]] == TRUE, na.rm = TRUE) / total * 100, 2)
  false_percent <- round(sum(data[[col]] == FALSE, na.rm = TRUE) / total * 100, 2)
  cat(sprintf("Kolumna: %s, TRUE: %.2f%%, FALSE: %.2f%%\n", col, true_percent, false_percent))
}
```

Kolumna: mainroad, TRUE: 86.46%, FALSE: 13.54%
Kolumna: guestroom, TRUE: 17.80%, FALSE: 82.20%
Kolumna: basement, TRUE: 35.05%, FALSE: 64.95%
Kolumna: hotwaterheating, TRUE: 4.59%, FALSE: 95.41%
Kolumna: airconditioning, TRUE: 31.56%, FALSE: 68.44%
Kolumna: prefarea, TRUE: 24.65%, FALSE: 75.35%

Dodatkowo aby lepiej zobarzować dane pokazane w podsumowaniu tworzymy wykresy słupkowe dla podanych zmiennych

```{r}
for (col in logical_columns) {
  true_percent <- mean(data[[col]] == TRUE, na.rm = TRUE) * 100
  false_percent <- mean(data[[col]] == FALSE, na.rm = TRUE) * 100
  
  barplot(
    c("TRUE" = true_percent, "FALSE" = false_percent),
    main = paste("Procent TRUE/FALSE dla", col),
    ylab = "Procent",
    col = c("lightblue", "lightcoral")
  )
}
```

### Analiza struktury danych dla zmiennej 'furnishingstatus'

```{r}
furnishing_counts <- table(data$furnishingstatus)
furnishing_percentages <- round(prop.table(furnishing_counts) * 100, 2)


print(furnishing_percentages)


barplot(
  furnishing_percentages,
  main = "Procentowy rozkład furnishingstatus",
  ylab = "Procent",
  col = c("lightblue", "lightgreen", "lightcoral"),
  names.arg = names(furnishing_percentages)
)
```

## Imputacja braków danych metodą sequential hotdeck

Zdecydowałyśmy się na metodę sequential hot-deck do imputacji brakujących danych.Metoda Sequential hot-deck wykorzystuje rzeczywiste wartości z naszego zbioru danych, co sprawia, że prawdopodobieństwo wprowadzenia sztucznych wartości jest małe. Dodatkowo załeży nam na zachowaniu naturalnego rozkładu danych. Metoda ta jest elastyczna i działa zarówno dla danych liczbowych, jak i kategorycznych, nie wymagając założeń o rozkładzie zmiennych. Dodatkowo, metoda ta jest odporna na outliery co było dla nas ważne po wcześniejszym zbadaniu ich występowania dla zmiennych price i area. na koniec prównamy brakujące dane przed i po imputacji aby upewnić się, że proces przebiegł pomyślnie.

```{r}

data_not_cleaned <- hotdeck(data)


cat("Liczba brakujących wartości po imputacji:", sum(is.na(data_not_cleaned)), "\n")


remove_imp_columns <- function(df) {
 
  if (!is.data.frame(df)) {
    stop("Podany obiekt nie jest ramką danych")
  }
  
 
  imp_cols <- grep("_imp$", colnames(df), value = TRUE)
  
 
  if (length(imp_cols) == 0) {
    message("Nie znaleziono kolumn z '_imp' w nazwie.")
    return(df)
  }
  

  df_cleaned <- df[, !colnames(df) %in% imp_cols]
  
  message("Usunięto następujące kolumny: ", paste(imp_cols, collapse = ", "))
  
  return(df_cleaned)
}


data_imputed <- remove_imp_columns(data_not_cleaned)


cat("Struktura danych po usunięciu kolumn '_imp':")
str(data_imputed)


head(data_imputed)
```
#Normalizacja zmiennych numerycznych 

Kolejnym etapem jest normalizacja zmiennych numerycznych, takich jak cena, powierzchnia, liczba sypialni, czy liczba miejsc parkingowych, co pozwala na przekształcenie danych do wspólnej skali bez utraty relatywnej informacji. Do tego celu wykorzystano metodę min-max scaling, która przekształca wartości w przedziale od 0 do 1, co ułatwia dalsze analizy statystyczne oraz modelowanie. Proces normalizacji zapewnia większą spójność danych i eliminuje wpływ różnych skal poszczególnych zmiennych na wyniki analizy.Dzięki zastosowanym technikom przetwarzania danych uzyskane wyniki pozwolą na dokładniejszą interpretację wpływu poszczególnych cech nieruchomości na ich wartość rynkową oraz na lepsze przygotowanie danych do wykorzystania w modelach predykcyjnych.

```{r}
minmax <- function(data, columns_to_normalize) {
  # Sprawdzenie, czy podane kolumny istnieją w danych
  missing_cols <- setdiff(columns_to_normalize, colnames(data))
  if (length(missing_cols) > 0) {
    stop(paste("Nie znaleziono kolumn:", paste(missing_cols, collapse = ", ")))
  }
  
  # Normalizacja wybranych kolumn
  data_imputed <- data %>%
    mutate(across(all_of(columns_to_normalize), 
                  ~ ifelse(all(is.na(.)), NA,  # Jeśli wszystkie wartości NA, zwróć NA
                           ifelse((max(., na.rm = TRUE) - min(., na.rm = TRUE)) == 0, 
                                  0,  # Jeśli brak rozstępu, przypisz 0
                                  (.-min(., na.rm = TRUE)) / (max(., na.rm = TRUE) - min(., na.rm = TRUE)))),
                  .names = "norm_{.col}"))
  
  return(data_imputed)
}

```
#Analiza opisowa 

```{r table, message=FALSE, warning=FALSE, include=FALSE, paged.print=FALSE}
#Tworzenie tabeli częstości dla cen
tabela1<-freq(limits,type="html")

```

## Tabele liczności oraz TAI
```{r}
str(data_imputed$price)
as.numeric(data_imputed$price)
data_imputed$price <- as.numeric(data_imputed$price)
range(data_imputed$price, na.rm=TRUE)
max(data_imputed$price)-min(data_imputed$price, na.rm = TRUE)

etykiety<-c("1.750.000-2.750.000", "2.750.000-3.750.000", "3.750.000-4.750.000", "4.750.000-5.750.000", "5.750.000-6.750.000", "6.750.000-7.750.000", "7.750.000-8.750.000", "8.750.000-9.750.000", "9.750.000-10.750.000", "10.750.000-11.750.000")
limits <- cut(data_imputed$price,seq(1750000,12250000,by=1000000), labels=etykiety)  
table1<-table(limits)
klasy <- as.data.frame(table1)
klasy
klasy$rel_freq <- prop.table(klasy$Freq)
klasy$cum_freq <- cumsum(klasy$Freq)

names(klasy) <- c("limits", "freq", "rel_freq", "cum_freq")
View(klasy)

```
## Podstawowe wykresy
#histogram

```{r}

data_imputed$price <- as.numeric(data_imputed$price)

filtered_prices <- na.omit(data_imputed$price)
print(filtered_prices)

price_range <- range(filtered_prices, na.rm = TRUE)
print(price_range)

# Definiowanie przerw dla histogramu
breaks <- seq(floor(price_range[1] / 1000000) * 1000000, ceiling(price_range[2] / 1000000) * 1000000, by = 1000000)
print(breaks)
# Rysowanie histogramu i gęstości
hist(filtered_prices, prob = TRUE, breaks = breaks, main = "Price", sub = "in PLN")
lines(density(filtered_prices), col = 2)
```


```{r}
# Tworzenie tabeli
kbl(table1, caption = "Ceny mieszkań") %>%
  kable_material(c("striped", "hover"))
tab1<-classIntervals(data_imputed$price,n=10,style="fixed",fixedBreaks=seq(1750000,12250000,by=1000000))
price_range <- range(data_imputed$price, na.rm=TRUE)
print(price_range)
# Obliczenie wskaźnika dokładności tabeli (TAI)
jenks.tests(tab1)

#Wskaźnik TAI jest dość wysoki. 0,84 oznacza, że możemy zaakceptować zaproponowaną konstrukcję tablicy częstości.
```

```{r}
tab1<-classIntervals(data_imputed$price,n=10,style="fixed",fixedBreaks=seq(1750000,12250000,by=1000000))
pcol= c('darkblue', 'blue', 'lightblue', 'palegreen', 'lightpink', 'brown3', 'red', 'yellow', 'brown', 'black')
colcode=findColours(tab1,pcol)
plot(tab1,pal=pcol,ylab='Cumulative %')

```

```{r histogram, echo=FALSE}
# Zastosowanie reguły Freedman/Diaconis do tworzenia histogramu

hist(data_imputed$price, breaks="FD", col="green", probability = TRUE,
     main="Ceny mieszkań")
lines(density(data_imputed$price[data_imputed$furnishingstatus=="furnished"]),col=2)
lines(density(data_imputed$price[data_imputed$furnishingstatus=="semi-furnished"]),col=3)
lines(density(data_imputed$price[data_imputed$furnishingstatus=="unfurnished"]),col=4)
legend("topright", legend=c("furnished", "semi-furnished", "unfurnished"),
       col=c(2,3), lty=1:2, horiz=FALSE, box.lty=0, cex=0.8)

```
```{r boxplot, echo=FALSE}
# Tworzenie wykresu pudełkowego dla cen według statusu umeblowania
boxplot(data_imputed$price ~ data_imputed$furnishingstatus)
```

```{r histogram2, echo=FALSE}
#Tworzenie wykresu gęstości dla cen z uwzględnieniem statusu umeblowania
density.p <- ggdensity(data_imputed, x = "price", 
                       fill = "furnishingstatus", palette = "jco")+
  stat_overlay_normal_density(color = "red", linetype = "dashed")
View(density.p)

# Liczymy statystyki wg statusu umeblowania
stable <- desc_statby(data_imputed, measure.var = "price",
                      grps = "furnishingstatus")
stable <- stable[, c("furnishingstatus", "length", "mean", "sd")]
# Tabela tekstowa z wynikami
stable.p <- ggtexttable(stable, rows = NULL, 
                        theme = ttheme("mOrange"))

text <- paste("Ceny mieszkań wg statusu umeblowania.",
               sep = " ")
text.p <- ggparagraph(text = text, face = "italic", size = 11, color = "black")
# Aranżujemy wykresy na tym samym panelu:
ggarrange(density.p, stable.p, text.p, 
          ncol = 1, nrow = 3,
          heights = c(1, 0.5, 0.3))
```

```{r boxplot2, echo=FALSE}
# Tworzenie wykresu pudełkowego z oznaczeniem średnich wartości
ggplot(data_imputed, aes(x=furnishingstatus, y=price)) +
    geom_boxplot(alpha=0.7) +
    stat_summary(fun="mean", geom="point", shape=20, size=5, color="red", fill="red") +
 geom_jitter() +
    facet_grid(~furnishingstatus) +
    scale_fill_brewer(palette="Set1")
```

```{r facet1, echo=FALSE}
## Grupowanie wykresów według liczby pokoi
plot1 <- ggplot(data_imputed, aes(x=bedrooms, price)) + 
  geom_abline() +
  geom_jitter(width = 0.1, height = 0.1) 
plot1 + facet_wrap(~ bedrooms)

```
```{r}
# Porównanie średniej, mediany i kwantyli dla cen

mean(data_imputed$price)
    median(data_imputed$price)
    sd(data_imputed$price) #standard deviation
    var(data_imputed$price) #variance
    coeff_var<-sd(data_imputed$price)/mean(data_imputed$price) #coefficient of variability %
    coeff_var
    IQR(data_imputed$price)# difference between quartiles =Q3-Q1 
    sx<-IQR(data_imputed$price)/2  #interquartile deviation
    coeff_varx<-sx/median(data_imputed$price) #IQR coefficient of variability %
    coeff_varx
    min(data_imputed$price)
    max(data_imputed$price)
    quantile(data_imputed$price,probs=c(0,0.1,0.25,0.5,0.75,0.95,1),na.rm=TRUE)
    
```
```{r kable_report, echo=FALSE}
#Tworzenie tabeli z wykresami dla różnych liczby pokoi
data_imputed_list <- split(data_imputed$price, data_imputed$bedrooms)
inline_plot <- data.frame(rooms = c(1, 2, 3, 4, 5, 6), boxplot = "", histogram = "", line1 = "", line2 = "", points1 = "")
  inline_plot %>%
  kbl(booktabs = TRUE) %>%
  kable_paper(full_width = FALSE) %>%
  column_spec(2, image = spec_boxplot(data_imputed_list)) %>%
  column_spec(3, image = spec_hist(data_imputed_list)) %>%
  column_spec(4, image = spec_plot(data_imputed_list, same_lim = TRUE)) %>%
  column_spec(5, image = spec_plot(data_imputed_list, same_lim = FALSE)) %>%
  column_spec(6, image = spec_plot(data_imputed_list, type = "p"))

```
```{r kable_report, echo=FALSE}
# Tworzenie tabeli z wykresami według ogrzewania wody
mieszkania_list <- split(data_imputed$price, data_imputed$hotwaterheating)
inline_plot <- data.frame(hotwaterheating = c(TRUE, FALSE), boxplot = "", histogram = "", line1 = "", line2 = "", points1 = "")
  inline_plot %>%
  kbl(booktabs = TRUE) %>%
  kable_paper(full_width = FALSE) %>%
  column_spec(2, image = spec_boxplot(mieszkania_list)) %>%
  column_spec(3, image = spec_hist(mieszkania_list)) %>%
  column_spec(4, image = spec_plot(mieszkania_list, same_lim = TRUE)) %>%
  column_spec(5, image = spec_plot(mieszkania_list, same_lim = FALSE)) %>%
  column_spec(6, image = spec_plot(mieszkania_list, type = "p"))

```
```{r kable_report2, echo=FALSE, message=FALSE, warning=FALSE, results='asis'}
raport <-
  list("Cena" =
       list("Min"= ~ min(data_imputed$price),
            "Max"= ~ max(data_imputed$price),
            "Kwartyl dolny"= ~ quantile(data_imputed$price,0.25),
            "Mediana"= ~ round(median(data_imputed$price),2),
            "Kwartyl górny"= ~ quantile(data_imputed$price,0.75),
            "Średnia"= ~ round(mean(data_imputed$price),2),
            "Odch. std."= ~ round(sd(data_imputed$price),2),
            "IQR"= ~ round(iqr(data_imputed$price),2),
            "Odchylenie ćwiartkowe"=~round(iqr(data_imputed$price)/2,2),
            "Odch. std. w %"=~round((sd(data_imputed$price)/mean(data_imputed$price)),2),
            "Odch. ćwiartkowe w %"=~round((iqr(data_imputed$price)/median(data_imputed$price)),2),
            "Skośność"=~round(skew(data_imputed$price),2),
            "Kurtoza"=~round(kurtosi(data_imputed$price),2)
            ))
tabela<-summary_table(data_imputed, summaries = raport, by = data_imputed$bedrooms)
tabela

knitr::kable(tabela,
  digits = 2,
  align = "lcccc",
  caption="Tabela. Ceny mieszkań wg liczby pokoi.",
  col.names = c("Statystyka","1 pokój", "2 pokoje", "3 pokoje", "4 pokoje", "5 pokoi")) 

```
```{r}
install.packages(gtsummary)
library(gtsummary)
data_imputed %>%
  select(data_imputed$price,data_imputed$bedrooms) %>%
  tbl_summary(
    by=bedrooms,
    type = all_continuous() ~ "continuous2",
    statistic = all_continuous() ~ c(
      "{N_nonmiss}","{mean}","{sd}",
      "{median} ({p25}, {p75})",
      "{min}, {max}"),
    missing = "no",
    label = data_imputed$price ~ "Cena") %>%
  modify_header(label ~ "**Zmienna**") %>%
  modify_caption("**Tabela 1. Rozkład cen wg liczby pokoi**") %>%
  bold_labels() %>% 
  add_p(pvalue_fun = ~ style_pvalue(.x, digits = 2))

```





Wizualizacja danych
1. Mapowanie danych (wykresy)
Na przykładzie zależności między ceną (price) a powierzchnią (area).
```{r}
# Wykres rozrzutu z ceną na osi Y i powierzchnią na osi X
library(ggplot2)

ggplot(data_imputed, aes(x = area, y = price, color = prefarea)) +
  geom_point(size = 3, alpha = 0.7) +
  scale_color_manual(values = c("TRUE" = "blue", "FALSE" = "red")) +
  labs(title = "Cena vs. Powierzchnia z podziałem na preferowaną lokalizację",
       x = "Powierzchnia (m2)",
       y = "Cena (PLN)") +
  theme_minimal()
```
Wykres przedstawia zależność między ceną nieruchomości a ich powierzchnią, z uwzględnieniem podziału na preferowane obszary. Na osi pionowej znajduje się cena w PLN, a na osi poziomej powierzchnia w metrach kwadratowych. Wartości ceny wahają się od 2,500,000 PLN do 12,500,000 PLN, podczas gdy powierzchnia mieści się w zakresie od 0 do 16,000 m².
Wykres wskazuje na ogólną tendencję wzrostu ceny wraz ze wzrostem powierzchni, co jest zgodne z oczekiwaniami.
Punkty danych są podzielone na dwie kategorie: prefarea = TRUE i prefarea = FALSE. Można zauważyć, że nieruchomości zlokalizowane w preferowanych obszarach (prefarea = TRUE) mają tendencję do osiągania wyższych cen przy podobnej powierzchni w porównaniu do nieruchomości z obszarów niepreferowanych.

Wnioski:
Lokalizacja w preferowanym obszarze ma istotny wpływ na cenę nieruchomości, co sugeruje, że czynniki lokalizacyjne są kluczowe w wycenie nieruchomości.

2. Wizualizacja ilości
a) Histogram rozkładu liczby sypialni (bedrooms).
```{r}
# Histogram liczby sypialni
ggplot(data_imputed, aes(x = bedrooms)) +
  geom_bar(fill = "steelblue", color = "black", alpha = 0.8) +
  labs(title = "Rozkład liczby sypialni",
       x = "Liczba sypialni",
       y = "Liczba nieruchomości") +
  theme_minimal()
```
Wykres przedstawia rozkład liczby sypialni w analizowanych nieruchomościach. Na osi pionowej znajduje się liczba nieruchomości, a na osi poziomej liczba sypialni.
Większość nieruchomości posiada od 2 do 4 sypialni, co wskazuje na dominację nieruchomości o średniej wielkości.
Nieruchomości z 1 sypialnią lub więcej niż 4 sypialnie są znacznie mniej liczne.

Wnioski:
Rozkład ten sugeruje, że rynek nieruchomości jest zdominowany przez mieszkania i domy o średniej wielkości, co może odzwierciedlać preferencje nabywców.

b) Liczba nieruchomości w zależności od dostępu do drogi głównej (mainroad):
```{r}
# Histogram liczby nieruchomości z dostępem do drogi głównej
ggplot(data_imputed, aes(x = mainroad)) +
  geom_bar(fill = "orange", color = "black", alpha = 0.8) +
  labs(title = "Liczba nieruchomości z dostępem do drogi głównej",
       x = "Dostęp do drogi głównej",
       y = "Liczba nieruchomości") +
  theme_minimal()
```
Wykres przedstawia liczbę nieruchomości z dostępem do drogi głównej, podzielonych na kategorie TRUE (dostęp) i FALSE (brak dostępu).
Większość nieruchomości posiada dostęp do drogi głównej, co może wpływać na ich atrakcyjność i cenę.
Nieruchomości bez dostępu do drogi głównej stanowią mniejszość.

Wnioski:
Dostęp do drogi głównej jest istotnym czynnikiem wpływającym na wartość nieruchomości, co może być związane z wygodą dojazdu i ogólną dostępnością.

c) Liczba nieruchomości z klimatyzacją (airconditioning):
```{r}
# Histogram liczby nieruchomości z klimatyzacją
ggplot(data_imputed, aes(x = airconditioning)) +
  geom_bar(fill = "cyan", color = "black ", alpha = 0.8) +
  labs(title = "Liczba nieruchomości z klimatyzacją",
       x = "Klimatyzacja",
       y = "Liczba nieruchomości") +
  theme_minimal()
```
Wykres przedstawia liczbę nieruchomości wyposażonych w klimatyzację, podzielonych na kategorie TRUE (klimatyzacja) i FALSE (brak klimatyzacji).
Większość nieruchomości nie posiada klimatyzacji, co może odzwierciedlać specyfikę lokalnego rynku nieruchomości.
Nieruchomości z klimatyzacją stanowią mniejszość, co może wpływać na ich wyższą cenę.

Wnioski:
Klimatyzacja jest rzadkością w analizowanym zbiorze nieruchomości, co może sugerować, że jest to czynnik różnicujący i wpływający na wartość nieruchomości.

3. Wizualizacja rozkładów
a) Wykres rozkładu powierzchni (area) z podziałem na obecność klimatyzacji (airconditioning).
```{r}
# Wykres gęstości powierzchni z podziałem na klimatyzację
ggplot(data_imputed, aes(x = area, fill = airconditioning)) +
  geom_density(alpha = 0.6) +
  scale_fill_manual(values = c("TRUE" = "green", "FALSE" = "orange")) +
  labs(title = "Rozkład powierzchni w zależności od klimatyzacji",
       x = "Powierzchnia (m2)",
       y = "Gęstość",
       fill = "Klimatyzacja") +
  theme_minimal()
```
Wykres przedstawia rozkład powierzchni nieruchomości w zależności od obecności klimatyzacji. Na osi pionowej znajduje się gęstość, a na osi poziomej powierzchnia w metrach kwadratowych.
Nieruchomości z klimatyzacją mają tendencję do większej powierzchni w porównaniu do nieruchomości bez klimatyzacji.
Rozkład powierzchni dla nieruchomości z klimatyzacją jest bardziej rozproszony, co może wskazywać na większą różnorodność w tej kategorii.

Wnioski:
Klimatyzacja jest częściej spotykana w większych nieruchomościach, co może sugerować, że jest to cecha charakterystyczna dla nieruchomości o wyższym standardzie.

b) Rozkład cen (price) z podziałem na status umeblowania (furnishingstatus):
```{r}
# Rozkład cen z podziałem na umeblowanie
ggplot(data_imputed, aes(x = price, fill = furnishingstatus)) +
  geom_density(alpha = 0.6) +
  scale_fill_manual(values = c("furnished" = "purple", "semi-furnished" = "pink", "unfurnished" = "grey")) +
  labs(title = "Rozkład cen w zależności od statusu umeblowania",
       x = "Cena (PLN)",
       y = "Gęstość",
       fill = "Status umeblowania") +
  theme_minimal()
```
Wykres przedstawia rozkład cen nieruchomości w zależności od ich statusu umeblowania. Na osi pionowej znajduje się gęstość, a na osi poziomej cena w PLN. Status umeblowania jest podzielony na trzy kategorie: furnished (umeblowane), semi-furnished (częściowo umeblowane) i unfurnished (nieumeblowane).
Nieruchomości umeblowane (furnished) mają tendencję do osiągania wyższych cen w porównaniu do nieruchomości częściowo umeblowanych (semi-furnished) i nieumeblowanych (unfurnished).
Rozkład cen dla nieruchomości nieumeblowanych jest bardziej skoncentrowany w niższych przedziałach cenowych.

Wnioski:
Status umeblowania ma istotny wpływ na cenę nieruchomości, co sugeruje, że nabywcy są skłonni płacić więcej za nieruchomości gotowe do zamieszkania.

c) Rozkład liczby parkingów (parking):
```{r}
# Rozkład liczby parkingów
ggplot(data_imputed, aes(x = parking)) +
  geom_histogram(binwidth = 1, fill = "lightblue", color = "black", alpha = 0.8) +
  labs(title = "Rozkład liczby parkingów",
       x = "Liczba parkingów",
       y = "Liczba nieruchomości") +
  theme_minimal()
```
Wykres przedstawia rozkład liczby parkingów dostępnych w analizowanych nieruchomościach. Na osi poziomej znajduje się liczba parkingów, a na osi pionowej liczba nieruchomości.
Większość nieruchomości posiada 1 lub 2 miejsca parkingowe, co wskazuje na standardową dostępność parkingów.
Nieruchomości z 3 miejscami parkingowymi są rzadkością.

Wnioski:
Liczba miejsc parkingowych jest istotnym czynnikiem wpływającym na atrakcyjność nieruchomości, szczególnie w obszarach o ograniczonej dostępności parkingów.

4. Wizualizacja proporcji
a) Wykres kołowy dla statusu umeblowania (furnishingstatus).
```{r}
# Proporcje statusu umeblowania
library(dplyr)

data_imputed %>%
  count(furnishingstatus) %>%
  ggplot(aes(x = "", y = n, fill = furnishingstatus)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y") +
  scale_fill_manual(values = c("furnished" = "purple", "semi-furnished" = "pink", "unfurnished" = "grey")) +
  labs(title = "Proporcja statusu umeblowania",
       fill = "Status umeblowania") +
  theme_void()
```
Wykres przedstawia proporcje nieruchomości według statusu umeblowania: furnished, semi-furnished i unfurnished.
Największy odsetek nieruchomości to te nieumeblowane (unfurnished), co może odzwierciedlać preferencje nabywców do personalizacji przestrzeni.
Nieruchomości umeblowane (furnished) stanowią mniejszość, ale są bardziej pożądane ze względu na wyższą cenę.

Wnioski:
Rynek nieruchomości jest zdominowany przez nieruchomości nieumeblowane, co może wpływać na strategie marketingowe i wycenę nieruchomości.

b) Proporcje dostępu do piwnicy (basement):
```{r}
data_imputed %>%
  count(basement) %>%
  ggplot(aes(x = "", y = n, fill = basement)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y") +
  scale_fill_manual(values = c("TRUE" = "blue", "FALSE" = "gray")) +
  labs(title = "Proporcja nieruchomości z piwnicą",
       fill = "Piwnica") +
  theme_void()
```
Wykres przedstawia proporcje nieruchomości z piwnicą (TRUE) i bez piwnicy (FALSE).
Większość nieruchomości posiada piwnicę, co może zwiększać ich funkcjonalność i atrakcyjność.
Nieruchomości bez piwnicy stanowią mniejszość.

Wnioski:
Obecność piwnicy jest istotnym czynnikiem wpływającym na wartość nieruchomości, szczególnie w kontekście dodatkowej przestrzeni magazynowej.

c) Proporcja nieruchomości z ogrzewaniem wody (hotwaterheating):
```{r}
# Wykres proporcji ogrzewania wody
data_imputed %>%
  count(hotwaterheating) %>%
  ggplot(aes(x = "", y = n, fill = hotwaterheating)) +
  geom_bar(stat = "identity", width = 1) +
  coord_polar("y") +
  scale_fill_manual(values = c("TRUE" = "green", "FALSE" = "red")) +
  labs(title = "Proporcja nieruchomości z ogrzewaniem wody",
       fill = "Ogrzewanie wody") +
  theme_void()
```
Wykres przedstawia proporcje nieruchomości z ogrzewaniem wody (TRUE) i bez ogrzewania wody (FALSE).
Większość nieruchomości jest wyposażona w system ogrzewania wody, co jest standardem w nowoczesnych nieruchomościach.
Nieruchomości bez ogrzewania wody stanowią mniejszość.

Wnioski:
Ogrzewanie wody jest powszechnym i oczekiwanym udogodnieniem, które wpływa na komfort użytkowania nieruchomości.

### Podsumowanie analizy wizualizacji danych

Przeprowadzona analiza wizualizacji danych wykonanych w R-Studio dostarcza kompleksowego obrazu rynku nieruchomości, uwzględniającego różnorodne czynniki wpływające na ich wartość i atrakcyjność. Wnioski płynące z analizy wskazują, że kluczowe determinanty cen nieruchomości obejmują lokalizację, dostęp do infrastruktury, standard wyposażenia oraz funkcjonalność.

Lokalizacja w preferowanych obszarach znacząco wpływa na wyższą wartość nieruchomości, co podkreśla wagę czynników geograficznych i społecznych. Dostęp do drogi głównej oraz liczba miejsc parkingowych są istotnymi elementami zwiększającymi atrakcyjność nieruchomości, szczególnie w kontekście wygody i dostępności.

Standard wyposażenia, taki jak klimatyzacja czy ogrzewanie wody, również odgrywa ważną rolę w kształtowaniu cen. Nieruchomości wyposażone w te udogodnienia są postrzegane jako bardziej wartościowe, co odzwierciedla preferencje nabywców dotyczące komfortu użytkowania. Status umeblowania dodatkowo różnicuje rynek, z nieruchomościami umeblowanymi osiągającymi wyższe ceny, co sugeruje, że gotowość do zamieszkania jest istotnym atutem.

Funkcjonalność nieruchomości, w tym obecność piwnicy, wpływa na ich praktyczność i atrakcyjność, szczególnie w kontekście dodatkowej przestrzeni użytkowej. Rozkład liczby sypialni wskazuje na dominację nieruchomości o średniej wielkości, co może odzwierciedlać preferencje nabywców dotyczące przestrzeni mieszkalnej.

Podsumowując, analiza wizualizacji danych pozwala na zidentyfikowanie kluczowych czynników kształtujących rynek nieruchomości. Wnioski te mogą stanowić cenne źródło informacji dla inwestorów, deweloperów oraz nabywców, umożliwiając bardziej świadome podejmowanie decyzji inwestycyjnych i rynkowych.

## Wnioskowanie statystyczne 

```{r}
summary(data[, sapply(df, is.numeric)]) 
```


# Opis statystyczny zmiennych numerycznych 

# Analiza różnic między grupami (price vs furnishingstatus) 

Analiza zależności między zmiennymi (price vs area)

# Macierz korelacji dla zmiennych numerycznych 

# Wizualizacja proporcji zmiennej kategorycznej (furnishingstatus)

## Podsumowanie wnioskowania statystycznego 


